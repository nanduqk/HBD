/*
ï¿½2010 - 2016 SAP SE or an SAP affiliate company.  All rights reserved.
 
SAP and other SAP products and services mentioned herein as well as their respective logos are trademarks or registered trademarks of SAP SE in Germany and other countries.  Please see http://www.sap.com/corporate-en/legal/copyright/index.epx#trademark for additional trademark information and notices.
*/

jQuery.sap.declare({modName:"com.sap.fioribi.modules.UserSettings.UserSettingsController",type:"controller"});jQuery.sap.require({modName:"com.sap.fioribi.modules.common.BILPController",type:"controller"});com.sap.fioribi.modules.UserSettings.UserSettingsController=function(){com.sap.fioribi.modules.common.BILPController.apply(this,arguments);};com.sap.fioribi.modules.UserSettings.UserSettingsController.prototype=jQuery.sap.newObject(com.sap.fioribi.modules.common.BILPController.prototype);com.sap.fioribi.modules.UserSettings.UserSettingsController.prototype.onInit=function(){var currentController=this;var reqDispatcher=new RequestDispatcher();var showAccountInfo=function(response){BILaunchpadApp.setPersonalRootCategoryID(response.personalCategoryID);var user=new sap.ui.model.json.JSONModel(response);if(response.id!=undefined){BILaunchpadApp.setUserId(response.id);}currentController.getView().setModel(user);};var errorAccountInfo=function(xhr,ajaxOptions,thrownError){var clsBtn=new sap.m.Button({text:BILaunchpadApp.localized("Recycle_Bin_Close"),press:$.proxy(function(){errDialog.close();},this)});var errDialog=new sap.m.Dialog().addButton(clsBtn);errDialog.open();errDialog.setTitle(BILaunchpadApp.localized("Error"));BILaunchpadApp.oErrorHandler.showErrorMessage(xhr,errDialog);};var request={surl:BILaunchpadApp.getWebServiceBaseURL()+"/internal/v1/settings/myinfo",reqType:"GET",successHandler:showAccountInfo,errorHandler:errorAccountInfo,headers:{Accept:"application/json","Content-Type":"application/json;odata=verbose","x-sap-logontoken":BILaunchpadApp.getlogonToken()}};if(sap.ui.getCore().getModel("userSettingsMyInfo")==undefined){reqDispatcher.sendRequest(request);}else{var user=new sap.ui.model.json.JSONModel(sap.ui.getCore().getModel("userSettingsMyInfo"));if(response.id!=undefined){BILaunchpadApp.setUserId(response.id);}currentController.getView().setModel(user);}};com.sap.fioribi.modules.UserSettings.UserSettingsController.prototype.logout=function(){jQuery.sap.require("com.sap.fioribi.utils.RequestDispatcher");var reqDispatcher=new RequestDispatcher();var invokeCallback=findCallback("callbackGetBTToken");var btToken;if(invokeCallback!=null){btToken=invokeCallback();}var startFolderCallback=findCallback("callbackGetStartFolder");var startFolder;var logoffLink="logoff.jsp?bttoken="+btToken;if(startFolderCallback!=null){startFolder=startFolderCallback();if(startFolder&&startFolder!="null"){logoffLink=logoffLink+"&startFolder="+startFolder;}}var isCatCallback=findCallback("callbackGetisCat");var isCat;if(isCatCallback!=null){isCat=isCatCallback();if(isCat&&isCat!="null"){logoffLink=logoffLink+"&isCat="+isCat;}}logoffLink=logoffLink+"&logontoken="+encodeURIComponent(BILaunchpadApp.getlogonToken())+"&wacsurl="+encodeURIComponent(BILaunchpadApp.getWebServiceBaseURL())+"&isFioriLaunchpad=true";jQuery.sap.require("com.sap.fioribi.utils.CommonUtils");sendURLViaPOST(logoffLink,"_self");};com.sap.fioribi.modules.UserSettings.UserSettingsController.prototype.submitData=function(){var splitApp=sap.ui.getCore().byId("UserSettings");var detailPages=splitApp.getDetailPages();for(var page=detailPages.length-1;page>=0;page--){var currentPage=detailPages[page];var currentPageController=currentPage.getController();if(typeof currentPageController.save!=="undefined"){currentPageController.save();}}};
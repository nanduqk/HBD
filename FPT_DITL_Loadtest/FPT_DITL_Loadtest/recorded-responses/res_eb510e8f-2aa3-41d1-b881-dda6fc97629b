define("zen.rt.components.sdkhtml5chart/resources/js/dataMappers/SDKGenericDataMapper",["zen.rt.components.sdkhtml5chart/resources/js/dataMappers/SDKChartDataMapper","zen.rt.components.sdkhtml5chart/resources/js/charts/ChartException"],function(c,b){function a(){c.apply(this,arguments);this.createAnalysisAxis=function(l){var n=new d(this,l,false);var k=new d(this,l,true);var m=n.toAnalysisAxisData();var i=k.toAnalysisAxisData();var o=[{name:"",type:"Dimension",values:[""]}];var h=[];var j=e(this,l);if(!j.isAa1DimensionRequired){h=[];if(m.length){h.push({index:1,data:m});}if(i.length){h.push({index:h.length+1,data:i});}if(h.length===0){h=[{index:1,data:o}];}}else{if(i.length===0&&this.getMeasureAxis()==="COLUMNS"){h=[{index:1,data:m.length?m:o}];}else{h=[{index:1,data:i.length?i:o}];if(m.length){h.push({index:2,data:m});}else{if(j.isAa2DimensionRequired){h.push({index:2,data:o});}}}}return h;};this.createMeasureValues=function(H,z){var k=[];var D=this.getUtilsHelper();var p=this.indexOfMeasuresDimension(H.dimensions);var C=H.dimensions[p];var v=H.newChartOptionsProperties;var t=this;if(H.externalDimensions!==undefined&&this.indexOfMeasuresDimension(H.externalDimensions)!==-1){var n=H.externalDimensions[this.indexOfMeasuresDimension(H.externalDimensions)];k.push({type:"Measure",name:n.members[0].text,values:g(H.data.slice(0),z[0].data[0].values.length),key:n.members[0].key});}else{if(H.data&&H.data.length>0&&C.isFake){k.push({type:"Measure",name:"",values:g(H.data.slice(0),z[0].data[0].values.length),key:""});}else{var j=f(H,C,p);var u=j.map(function(i){return i.key;});var x=D.allChartOptionsMeasures(v);for(var B=0;B<x.length;B++){if(($.inArray(x[B],u)<=-1)){throw new b(H.messages.feedingerror,"");}}j.forEach(function(i){k.push({type:"Measure",name:i.text,values:[],key:i.key,initialIndex:i.initialIndex});});var l=new d(this,H,false);var m=new d(this,H,true);var E=e(this,H);var A=0;H.data.forEach(function(O,L){var I=H.tuples[L];var P=l.getIndexOnAxis(I);var N=m.getIndexOnAxis(I);var M=I[p];var K=_.findWhere(k,{initialIndex:M});var J;if(m.isEmpty()&&t.getMeasureAxis()==="COLUMNS"){N=P;P=0;}else{if(!E.isAa1DimensionRequired&&!l.isEmpty()){J=P;P=N;N=J;}}K.values[P]=K.values[P]||[];K.values[P][N]=O;A=Math.max(A,K.values[P].length);});_.forEach(k,function(i){i.values=_.map(i.values,function(K){var I=K||[];for(var J=0;J<A;J++){if(I.length<=J){I.push(null);}else{if(I[J]===undefined){I[J]=null;}}}return I;});});}}var w=D.getMetadataFeedsArray(H.cvomType,"Measure");var r=[];if(!D.isChartFeedsEmpty(v)){for(B=0;B<x.length;B++){var s=$.inArray(x[B],u);r.push(k[s]);}if(r.length>0){k=r;}}var G=this.getMeasureAxis();var h=this.getMessages().chart_mapping_error+".";if(H.cvomType==="viz/scatter"&&k.length<2){if(G==="COLUMNS"){throw new b(h,this.getMessages().scatter_datamapping_cmd);}else{throw new b(h,this.getMessages().scatter_datamapping_rmd);}}if(H.cvomType==="viz/bubble"&&k.length<3){if(G==="COLUMNS"){throw new b(h,this.getMessages().bubble_datamapping_cmd);}else{throw new b(h,this.getMessages().bubble_datamapping_rmd);}}var o;if(H.dualAxis){var F;if(this.getMeasureAxis()=="COLUMNS"){var q=H.cvomType;if(q=="viz/dual_line"){F=this.getMessages().dualline_datamapping_tmd;}if(q=="viz/dual_column"||q=="viz/dual_combination"){F=this.getMessages().dualcolumn_datamapping_tmd;}if(q=="viz/dual_horizontal_combination"){F=this.getMessages().dualhorizontal_datamapping_tmd;}if(q=="viz/dual_bar"){F=this.getMessages().dualbar_datamapping_tmd;}}if((F!==undefined)&&(!H.newChartOptionsProperties||!H.newChartOptionsProperties.feeds)){throw new b(h,F);}o=H.dualAxis;}else{if(H.newChartOptionsProperties&&H.newChartOptionsProperties.feeds){o=this.generateAxisMapping(H.newChartOptionsProperties.feeds,w);}}var y=_.partial(_.omit,_,"initialIndex");k=_.map(k,y);if(o){return this.groupMeasureObjectsByAxisMapping(k,o,w);}else{return this.groupMeasureObjectsAutomatically(k,w);}};this.groupMeasureObjectsAutomatically=function(m,l){m.forEach(function(i){delete i.key;});var k=[];for(var j=0;j<l.length;j++){var h=[];if(l.length!==j+1){while(m.length&&h.length<(l[j].min||1)){h.push(m.shift());}}else{while(m.length&&h.length<(l[j].max)){h.push(m.shift());}}k.push({index:j+1,data:h});}return k;};this.groupMeasureObjectsByAxisMapping=function(q,h,j){var n=[];for(var p=0;p<j.length;p++){n[j[p].mgIndex-1]={index:j[p].mgIndex,data:[]};}for(var l=0;l<h.length&&l<q.length;l++){var k=q[l];var o=h[l];if(typeof o!=="string"){o=o[1];}var m=o.slice(o.length-1);m=m-1;n[m].data.push({name:k.name,type:k.type,values:k.values});}return n;};this.indexOfMeasuresDimension=function(j){for(var h=0;h<j.length;h++){var k=j[h];if(k.containsMeasures===true){return h;}}return -1;};this.generateAxisMapping=function(p,o){var k=[];var n=[];for(var h in p){for(var m=0;m<p[h].length;m++){for(var l=0;l<o.length;l++){if(o[l].id==h||o[l].id==h.replace(/_/g,".")){n.push({index:o[l].mgIndex,axisArray:["stub","axis"+o[l].mgIndex,p[h][m]]});}}}}n=_.sortBy(n,"index");_.forEach(n,function(i){k.push(i.axisArray);});return k;};function f(k,j,i){var l=[],m={},h;if(j.axis==="ROWS"){h=k.axis_rows;}else{h=k.axis_columns;}h.forEach(function(n){var p=j.members[n[i]],o;if(!m[p.key]){o=_.clone(p);o.initialIndex=n[i];l.push(o);m[p.key]=true;}});return l;}function g(h,i){var j=[];while(h.length){j.push(h.splice(0,i));}return j;}function e(m,l){var n=m.getUtilsHelper().getMetadataFeedsArray(l.cvomType,"Dimension");var h;var j;for(var k=0;k<n.length;k++){if(n[k].aaIndex===1){h=n[k];}if(n[k].aaIndex===2){j=n[k];}if(h!==undefined&&j!==undefined){break;}}return{isAa1DimensionRequired:!(h&&h.min===0),isAa2DimensionRequired:j&&j.min>0};}function d(h,o,r){var k=r?o.axis_columns:o.axis_rows;var i=o.dimensions;var t=h.indexOfMeasuresDimension(i);var v=[];var s=[];if(k.length){_.forEach(k[0],function(w,x){if(w!=-1&&x!=t){s.push(x);}});}var l=_.map(k,p);v=_.uniq(v);if(v.length&&l.length&&l[0].length){var m={};_.forEach(l,function(x){var w=_.pluck(x,"dimensionIndex");m[w]=m[w]||[];m[w].push(x[0].measureIndex);});_.forEach(m,function(x,y){var w=_.difference(v,x);_.forEach(w,function(z){j(y,z);});});}l=_.uniq(l,false,function(x){var w=_.pluck(x,"value");return w.toString();});this.toAnalysisAxisData=function(){var w=[];_.forEach(l,function(x){_.forEach(x,function(z,y){w[y]=w[y]||{type:"Dimension",name:z.name,values:[]};w[y].values.push(z.dimensionValue.text);});});return w;};this.getIndexOnAxis=function(w){var y=p(w);var x=-1;for(var z=0;z<l.length&&x===-1;z++){if(u(y,l[z])){x=z;}}return x;};this.isEmpty=function(){return !l.length||!l[0].length;};function j(w,y){var x=[];_.forEach(w,function(z){x.push(n(null,z,y));});}function n(x,w,y){return{dimensionIndex:w,dimensionValue:i[w].members[x],measureIndex:y,name:i[w].text,value:x};}function u(x,w){return x&&w&&q(x,w)===0;}function q(y,x){var z=0;for(var w=0;w<y.length&&z===0;w++){if(y[w].value<x[w].value){z=-1;}else{if(y[w].value>x[w].value){z=1;}}}return z;}function p(w){var x=w[t];if(x>=0){v.push(x);}return _.chain(w).map(function(z,y){return n(z,y,x);}).filter(function(z,y){return _.contains(s,y);}).value();}}}return a;});
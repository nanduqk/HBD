/*
ï¿½2010 - 2016 SAP SE or an SAP affiliate company.  All rights reserved.
 
SAP and other SAP products and services mentioned herein as well as their respective logos are trademarks or registered trademarks of SAP SE in Germany and other countries.  Please see http://www.sap.com/corporate-en/legal/copyright/index.epx#trademark for additional trademark information and notices.
*/

jQuery.sap.declare("com.sap.fioribi.modules.treetable.util.TreeTableDialogUtil");com.sap.fioribi.modules.treetable.util.TreeTableDialogUtil=function(){};com.sap.fioribi.modules.treetable.util.TreeTableDialogUtil.prototype.createFolderDialog=function(currentFolderNode,callback){var docNameLbl=new sap.m.Label({text:BILaunchpadApp.localized("Folder_Name")});var docNameValue=new sap.m.Input({placeholder:BILaunchpadApp.localized("Placeholder_newfolder")});docNameValue.addAriaLabelledBy(docNameLbl);var docDescLbl=new sap.m.Label({text:BILaunchpadApp.localized("Folder_Description")});var docDescValue=new sap.m.Input();docDescValue.addAriaLabelledBy(docDescLbl);var docKeywordLbl=new sap.m.Label({text:BILaunchpadApp.localized("Folder_Keywords")});var docKeywordValue=new sap.m.Input();docKeywordValue.addAriaLabelledBy(docKeywordLbl);var oTopBarDialog=new sap.m.Dialog({title:BILaunchpadApp.localized("create_folder"),verticalScrolling:false,content:[new sap.m.VBox({items:[docNameLbl,docNameValue,docDescLbl,docDescValue,docKeywordLbl,docKeywordValue]}).addStyleClass("BILP-CreateFolderDialog")],beginButton:new sap.m.Button({text:BILaunchpadApp.localized("text_Save"),press:$.proxy(function(){if(docNameValue.getValue()==""||docNameValue.getValue()==null){sap.m.MessageToast.show(BILaunchpadApp.localized("text_popupnoname"));}else{var folderDetails={name:docNameValue.getValue(),description:docDescValue.getValue(),keywords:docKeywordValue.getValue(),parentid:String(currentFolderNode.id)};this.createFolder(folderDetails,callback);oTopBarDialog.close();}},this)}),endButton:new sap.m.Button({text:BILaunchpadApp.localized("text_Cancel"),press:function(){oTopBarDialog.close();}})}).addStyleClass("sapUiSizeCompact");oTopBarDialog.open();};com.sap.fioribi.modules.treetable.util.TreeTableDialogUtil.prototype.createFolder=function(folderDetails,callback){var reqDispatcher=new RequestDispatcher();var createFolderError=function(xhr,ajaxOptions,thrownError){var errorMsg=xhr.message.toString();var duplicateFolderCode="(FWB 00026)";if(errorMsg.indexOf(duplicateFolderCode)!==-1){sap.m.MessageToast.show(BILaunchpadApp.localized("duplicateFolder"));}else{sap.m.MessageToast.show(BILaunchpadApp.localized("Error_Fail_folder_creation"));}sap.ui.core.BusyIndicator.hide();};var createFolderSuccess=function(response){sap.m.MessageToast.show("'"+folderDetails.name+"' "+BILaunchpadApp.localized("Folder_created"));callback();sap.ui.core.BusyIndicator.hide();};var request={surl:BILaunchpadApp.getWebServiceBaseURL()+"/v1/folders/folder",reqType:"POST",successHandler:$.proxy(createFolderSuccess,this),errorHandler:createFolderError,data:JSON.stringify(folderDetails),headers:{"x-SAP-logonToken":BILaunchpadApp.getlogonToken(),Accept:"application/json","Content-Type":"application/json;odata=verbose",}};sap.ui.core.BusyIndicator.show(0);reqDispatcher.sendRequest(request);};com.sap.fioribi.modules.treetable.util.TreeTableDialogUtil.prototype.Upload=function(file,cuid,name1,desc,key_words,oFileUpload,use_cr_strings,retain_cr_data,createcopy){function findCallback(name){try{if(name!=""){var mywin=window;if(mywin[name]){return mywin[name];}if(mywin.opener){mywin=mywin.opener;}else{if(mywin.parent){mwyin=mywin.parent;}else{return null;}}while(mywin){if(mywin[name]){return mywin[name];}if(mywin==mywin.parent){if(mywin.opener){mywin=mywin.opener;}else{return null;}}else{mywin=mywin.parent;}}}}catch(exception){}return null;}var tokVal=findCallback("callbackGetBTTOKEN2")();var logonToken=BILaunchpadApp.getlogonToken();this.folderDetails={keywords:key_words,name:name1,description:desc,parentid:String(cuid)};if(name1[0]==" "){sap.m.MessageToast.show(BILaunchpadApp.localized("Error_in_Uploading_File"));}var sMetaData="keywords="+key_words+"&name="+name1+"&description="+desc;sMetaData="name="+name1;var headerParam=new sap.ui.unified.FileUploaderParameter({name:"x-SAP-logonToken",value:logonToken});var headerCSRFParam=new sap.ui.unified.FileUploaderParameter({name:"CSRF_TOKEN_COOKIE",value:tokVal});oFileUpload.addHeaderParameter(headerParam);oFileUpload.getHeaderParameters().forEach(function(header){if(header.getName()=="x-SAP-logonToken"){header.setValue(logonToken);}});oFileUpload.addHeaderParameter(headerCSRFParam);var test={name:"name",value:name1};var oParam=new sap.ui.unified.FileUploaderParameter(test);oFileUpload.addParameter(oParam);var test={name:"keywords",value:key_words};var oParam=new sap.ui.unified.FileUploaderParameter(test);oFileUpload.addParameter(oParam);var test={name:"description",value:desc};var oParam=new sap.ui.unified.FileUploaderParameter(test);oFileUpload.addParameter(oParam);oFileUpload.addParameter(new sap.ui.unified.FileUploaderParameter({name:"useCRReportDescription",value:use_cr_strings}));oFileUpload.addParameter(new sap.ui.unified.FileUploaderParameter({name:"retainCRData",value:retain_cr_data}));headerParam=new sap.ui.unified.FileUploaderParameter({name:"Accept",value:"application/xml"});headerParam=new sap.ui.unified.FileUploaderParameter({name:"Content-Type",value:""});if(createcopy){oFileUpload.setUploadUrl(BILaunchpadApp.getWebServiceBaseURL()+"/v1/folders/"+cuid+"/file?createcopy=true");}else{oFileUpload.setUploadUrl(BILaunchpadApp.getWebServiceBaseURL()+"/v1/folders/"+cuid+"/file");}oFileUpload.setMimeType("POST");oFileUpload.upload();};com.sap.fioribi.modules.treetable.util.TreeTableDialogUtil.prototype.createHyperlink=function(controller,title_hyperlink,description_hyperlink,keywords_hyeprlink,url_hyeprlink){var hyperlinkobjectCuID=null;var cuid=controller.currentParentID;var reqDispatcher=new RequestDispatcher();this.hyperlinkDetails={keywords:keywords_hyeprlink,name:title_hyperlink,description:description_hyperlink,parentid:String(cuid),url:url_hyeprlink};var createHyperlinkError=function(xhr,ajaxOptions,thrownError){var errorMsg=xhr.message.toString();var duplicateFolderCode="(FWB 00026)";if(errorMsg.indexOf(duplicateFolderCode)!==-1){sap.m.MessageToast.show(BILaunchpadApp.localized("duplicate_Hyperlink"));}else{sap.m.MessageToast.show(BILaunchpadApp.localized("error_Fail_hyperlink_creation"));}sap.ui.core.BusyIndicator.hide();};var createHyperlinkSuccess=function(response){jQuery.sap.require("com.sap.fioribi.utils.HyperlinkUtil");var hyperlinkUtil=new com.sap.fioribi.utils.HyperlinkUtil();hyperlinkobjectCuID=hyperlinkUtil.getHyperlinkObjectCuId(response.id);controller.updateTable(cuid);sap.ui.core.BusyIndicator.hide();};var request={surl:BILaunchpadApp.getWebServiceBaseURL()+"/internal/v1/hyperlinks",reqType:"POST",bAsync:false,successHandler:$.proxy(createHyperlinkSuccess,this),errorHandler:createHyperlinkError,data:JSON.stringify(this.hyperlinkDetails),headers:{"x-SAP-logonToken":BILaunchpadApp.getlogonToken(),Accept:"application/json","Content-Type":"application/json;odata=verbose",}};sap.ui.core.BusyIndicator.show(0);reqDispatcher.sendRequest(request);if(hyperlinkobjectCuID!=null){return hyperlinkobjectCuID;}};
/*
ï¿½2010 - 2016 SAP SE or an SAP affiliate company.  All rights reserved.
 
SAP and other SAP products and services mentioned herein as well as their respective logos are trademarks or registered trademarks of SAP SE in Germany and other countries.  Please see http://www.sap.com/corporate-en/legal/copyright/index.epx#trademark for additional trademark information and notices.
*/

jQuery.sap.declare({modName:"com.sap.fioribi.app.BILaunchpadController",type:"controller"});jQuery.sap.require("sap.ui.core.mvc.Controller");com.sap.fioribi.app.BILaunchpadController=function(){sap.ui.core.mvc.Controller.apply(this,arguments);this.settingPagePreferences();this.getApplications();this.settingHomePagePreference();};jQuery.sap.require("com.sap.fioribi.utils.Pagination");var oPagination=new com.sap.fioribi.utils.Pagination();com.sap.fioribi.app.BILaunchpadController.prototype=jQuery.sap.newObject(sap.ui.core.mvc.Controller.prototype);com.sap.fioribi.app.BILaunchpadController.prototype.formatCount=function(response){var revert=JSON.parse(JSON.stringify(response));var noOfProperty=Object.keys(response).length;var objectKeys=Object.keys(response);for(var i=0;i<noOfProperty;i++){switch((function(){return objectKeys[i].toLowerCase();})(objectKeys[i])){case"folderscount":revert.folderscount=formatHelper(response[objectKeys[i]]);break;case"schedulescount":revert.schedulescount=formatHelper(response[objectKeys[i]]);break;case"documentcount":revert.documentcount=formatHelper(response[objectKeys[i]]);break;case"categorycount":revert.categorycount=formatHelper(response[objectKeys[i]]);break;case"unreadinboxitemscount":revert.unreadinboxitemscount=formatHelper(response[objectKeys[i]]);break;case"recycleditemscount":revert.recycleditemscount=formatHelper(response[objectKeys[i]]);break;}}function formatHelper(no){if(no<1000){return no;}else{if(no==1000){return"1k";}else{if(no>1000&&no<10000){var q=parseInt(no/1000);var reminder=no%1000;if(reminder==0){return q+"k";}else{return q+"k+";}}}}}return revert;};com.sap.fioribi.app.BILaunchpadController.prototype.formatTooltipForAccessibility=function(content,controlLength){if(content!=null&&content.length<controlLength){return" ";}else{return content;}};com.sap.fioribi.app.BILaunchpadController.prototype.getCount=function(url){$this=this;this.service=url;var updateTileInfo=function(response){var resp=$this.formatCount(response);if(JSON.stringify(resp).indexOf("documentCount")!=-1){sap.ui.getCore().getModel("myInfoCount").documentCountLastUpdated=response.currentServerTimeStamp;sap.ui.getCore().byId("Documents").mAggregations.tileContent[0].setFooter(BILaunchpadApp.localized("tileUpdated")+" "+BILaunchpadApp.localized("tileNow"));sap.ui.getCore().byId("Documents").mAggregations.tileContent[0].mAggregations.content.mAggregations.items[0].setProperty("value",resp.documentCount);sap.ui.getCore().byId("Documents").setState("Loaded");sap.ui.getCore().byId("Documents").rerender();sap.ui.getCore().setModel(resp.documentCount,"documentCount");}if(JSON.stringify(resp).indexOf("schedulesCount")!=-1){sap.ui.getCore().getModel("myInfoCount").scheduledInstancesCountLastUpdated=response.currentServerTimeStamp;sap.ui.getCore().byId("Schedules").mAggregations.tileContent[0].setFooter(BILaunchpadApp.localized("tileUpdated")+" "+BILaunchpadApp.localized("tileNow"));sap.ui.getCore().byId("Schedules").mAggregations.tileContent[0].mAggregations.content.mAggregations.items[0].setProperty("value",resp.schedulesCount);sap.ui.getCore().byId("Schedules").setState("Loaded");sap.ui.getCore().byId("Schedules").rerender();sap.ui.getCore().setModel(resp.schedulesCount,"schedulesCount");}if(JSON.stringify(resp).indexOf("categoryCount")!=-1){sap.ui.getCore().getModel("myInfoCount").categoryCountLastUpdated=response.currentServerTimeStamp;sap.ui.getCore().byId("Categories").mAggregations.tileContent[0].setFooter(BILaunchpadApp.localized("tileUpdated")+" "+BILaunchpadApp.localized("tileNow"));sap.ui.getCore().byId("Categories").mAggregations.tileContent[0].mAggregations.content.mAggregations.items[0].setProperty("value",resp.categorycount);sap.ui.getCore().byId("Categories").setState("Loaded");sap.ui.getCore().byId("Categories").rerender();sap.ui.getCore().setModel(resp.categorycount,"categoryCount");}if(JSON.stringify(resp).indexOf("unreadInboxItemsCount")!=-1){sap.ui.getCore().getModel("myInfoCount").inboxUnreadItemsCountLastUpdated=response.currentServerTimeStamp;sap.ui.getCore().byId("Inbox").mAggregations.tileContent[0].setFooter(BILaunchpadApp.localized("tileUpdated")+" "+BILaunchpadApp.localized("tileNow"));sap.ui.getCore().byId("Inbox").mAggregations.tileContent[0].mAggregations.content.mAggregations.items[0].setProperty("value",resp.unreadInboxItemsCount);sap.ui.getCore().byId("Inbox").setState("Loaded");sap.ui.getCore().byId("Inbox").rerender();sap.ui.getCore().setModel(resp.unreadInboxItemsCount,"unreadInboxItemsCount");}if(JSON.stringify(resp).indexOf("foldersCount")!=-1){sap.ui.getCore().getModel("myInfoCount").folderCountLastUpdated=response.currentServerTimeStamp;sap.ui.getCore().byId("Folders").mAggregations.tileContent[0].setFooter(BILaunchpadApp.localized("tileUpdated")+" "+BILaunchpadApp.localized("tileNow"));sap.ui.getCore().byId("Folders").mAggregations.tileContent[0].mAggregations.content.mAggregations.items[0].setProperty("value",resp.foldersCount);sap.ui.getCore().byId("Folders").setState("Loaded");sap.ui.getCore().byId("Folders").rerender();sap.ui.getCore().setModel(resp.foldersCount,"foldersCount");}if(JSON.stringify(resp).indexOf("recycledItemsCount")!=-1){sap.ui.getCore().getModel("myInfoCount").recycleBinItemsCountLastUpdated=response.currentServerTimeStamp;sap.ui.getCore().byId("RecycleBin").mAggregations.tileContent[0].setFooter(BILaunchpadApp.localized("tileUpdated")+" "+BILaunchpadApp.localized("tileNow"));sap.ui.getCore().byId("RecycleBin").mAggregations.tileContent[0].mAggregations.content.mAggregations.items[0].setProperty("value",resp.recycledItemsCount);sap.ui.getCore().byId("RecycleBin").setState("Loaded");sap.ui.getCore().byId("RecycleBin").rerender();sap.ui.getCore().setModel(resp.recycledItemsCount,"recycledItemsCount");}};var updateTileInfoError=function(response){if($this.service.indexOf("documentsCount")!=-1){sap.ui.getCore().byId("Documents").mAggregations.tileContent[0].setFooter(BILaunchpadApp.localized("tileNotRefresh"));}if($this.service.indexOf("scheduledInstancesCount")!=-1){sap.ui.getCore().byId("Schedules").mAggregations.tileContent[0].setFooter(BILaunchpadApp.localized("tileNotRefresh"));}if($this.service.indexOf("categoriesCount")!=-1){sap.ui.getCore().byId("Categories").mAggregations.tileContent[0].setFooter(BILaunchpadApp.localized("tileNotRefresh"));}if($this.service.indexOf("inboxUnredItemsCount")!=-1){sap.ui.getCore().byId("Inbox").mAggregations.tileContent[0].setFooter(BILaunchpadApp.localized("tileNotRefresh"));}if($this.service.indexOf("foldersCount")!=-1){sap.ui.getCore().byId("Folders").mAggregations.tileContent[0].setFooter(BILaunchpadApp.localized("tileNotRefresh"));}if($this.service.indexOf("recycleBinItemsCount")!=-1){sap.ui.getCore().byId("RecycleBin").mAggregations.tileContent[0].setFooter(BILaunchpadApp.localized("tileNotRefresh"));}var clsBtn=new sap.m.Button({text:BILaunchpadApp.localized("Error"),press:$.proxy(function(){errDialog.close();},this)});var errDialog=new sap.m.Dialog().addButton(clsBtn);errDialog.open();errDialog.setTitle(BILaunchpadApp.localized("Error"));BILaunchpadApp.oErrorHandler.showErrorMessage(xhr,errDialog);bError=true;};jQuery.sap.require("com.sap.fioribi.utils.RequestDispatcher");var uUrl=BILaunchpadApp.getWebServiceBaseURL()+"/internal/v1/"+url;var request={surl:uUrl,reqType:"GET",bAsync:true,successHandler:updateTileInfo,errorHandler:updateTileInfoError,headers:{"x-SAP-logonToken":BILaunchpadApp.getlogonToken(),Accept:"application/json","Content-Type":"application/json;odata=verbose",}};var reqDispatcher=new RequestDispatcher();reqDispatcher.sendRequest(request);};com.sap.fioribi.app.BILaunchpadController.prototype.settingPagePreferences=function(){jQuery.sap.require("com.sap.fioribi.utils.RequestDispatcher");var reqDispatcher=new RequestDispatcher();var setPagePreference=function(jsonData){sap.ui.getCore().setModel(jsonData,"pagePrefModel");sap.ui.getCore().setModel(jsonData,"userpagePrefModel");if(jsonData.selecthometab==""){jsonData.selecthometab="defaultTab";jsonData.landingpageoption="home";jsonData.listdocumentas="listview";jsonData.landingfilter="1";}if(jsonData.selecthometab=="defaultTab"){if(jsonData.landingpageoption==""){jsonData.landingpageoption="home";jsonData.listdocumentas="listview";jsonData.landingfilter="1";}}if(jsonData.selecthometab=="homeTab"||jsonData.selecthometab=="custom"){if(jsonData.landingpageoption=="home"){jsonData.selecthometab="customGroup";jsonData.landingfilter="3";}else{jsonData.selecthometab="customPage";}}BILaunchpadApp.setselecthometab(jsonData.selecthometab);BILaunchpadApp.setHomePageTab(jsonData.landingpageoption);BILaunchpadApp.setListingType(jsonData.listdocumentas);BILaunchpadApp.setHomePageFilter(jsonData.landingfilter);BILaunchpadApp.setType(jsonData.type);BILaunchpadApp.setLastRun(jsonData.lastrun);BILaunchpadApp.setInstances(jsonData.instances);BILaunchpadApp.setDescription(jsonData.description);BILaunchpadApp.setCreatedBy(jsonData.createdby);BILaunchpadApp.setLastUpdated(jsonData.lastupdated);BILaunchpadApp.setCreatedOn(jsonData.createdon);BILaunchpadApp.setLocationCategories(jsonData.locationcategories);BILaunchpadApp.setMyFavorites(jsonData.myfavorites);BILaunchpadApp.setStatusSchedule(jsonData.statusschedule);BILaunchpadApp.setSubscriptionSchedule(jsonData.subscriptionschedule);BILaunchpadApp.setInstanceTimeSchedule(jsonData.instancetimeschedule);BILaunchpadApp.setRecurrenceEndTimeSchedule(jsonData.recurrenceendtimeschedule);BILaunchpadApp.setViewReportInBILP(jsonData.viewreportinbilp);sap.ui.getCore().setModel(jsonData,"pagePrefModel");};var pagePrefAllSettings=function(allSettingsModel){setPagePreference(allSettingsModel.oData.entries[5]);};var errorPagePreference=function(xhr,ajaxOptions,thrownError){console.log("error");};var request={surl:BILaunchpadApp.getWebServiceBaseURL()+"/internal/v1/settings/userpreferences/pagepreferences",reqType:"GET",bAsync:false,successHandler:setPagePreference,errorHandler:errorPagePreference,headers:{Accept:"application/json","Content-Type":"application/json;odata=verbose","x-sap-logontoken":BILaunchpadApp.getlogonToken()}};var allSettingsModel=sap.ui.getCore().getModel("allSettingsModel");if(!allSettingsModel){reqDispatcher.sendRequest(request);}else{pagePrefAllSettings(allSettingsModel);}};com.sap.fioribi.app.BILaunchpadController.prototype.settingHomePagePreference=function(){jQuery.sap.require("com.sap.fioribi.utils.RequestDispatcher");var reqDispatcher=new RequestDispatcher();var setPagePreference=function(jsonData){sap.ui.getCore().setModel(jsonData,"homePagePrefModel");};var errorPagePreference=function(xhr,ajaxOptions,thrownError){console.log("error");};var request={surl:BILaunchpadApp.getWebServiceBaseURL()+"/internal/v1/settings/userpreferences/homepagepreference",reqType:"GET",bAsync:false,successHandler:setPagePreference,errorHandler:errorPagePreference,headers:{Accept:"application/json","Content-Type":"application/json;odata=verbose","x-sap-logontoken":BILaunchpadApp.getlogonToken()}};reqDispatcher.sendRequest(request);};com.sap.fioribi.app.BILaunchpadController.prototype.getApplications=function(){var success=function(response){sap.ui.core.BusyIndicator.hide();sap.ui.getCore().setModel(response,"applications");};var failure=function(response){sap.ui.core.BusyIndicator.hide();};jQuery.sap.require("com.sap.fioribi.utils.RequestDispatcher");var uUrl=BILaunchpadApp.getWebServiceBaseURL()+"/internal/v1/getApplications";var request={surl:uUrl,reqType:"GET",bAsync:false,successHandler:success,errorHandler:failure,headers:{"x-SAP-logonToken":BILaunchpadApp.getlogonToken(),Accept:"application/json","Content-Type":"application/json;odata=verbose",}};var reqDispatcher=new RequestDispatcher();sap.ui.core.BusyIndicator.show(0);reqDispatcher.sendRequest(request);};
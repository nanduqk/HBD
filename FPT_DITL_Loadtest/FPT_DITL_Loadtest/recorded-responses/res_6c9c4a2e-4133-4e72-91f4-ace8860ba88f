/*
ï¿½2010 - 2016 SAP SE or an SAP affiliate company.  All rights reserved.
 
SAP and other SAP products and services mentioned herein as well as their respective logos are trademarks or registered trademarks of SAP SE in Germany and other countries.  Please see http://www.sap.com/corporate-en/legal/copyright/index.epx#trademark for additional trademark information and notices.
*/

jQuery.sap.declare({modName:"com.sap.fioribi.components.dialogsave.DialogSaveView",type:"view"});jQuery.sap.require({modName:"com.sap.fioribi.modules.common.BILPView",type:"view"});com.sap.fioribi.components.dialogsave.DialogSaveView=function(data){this.sTitle=data.sTitle;com.sap.fioribi.modules.common.BILPView.apply(this,arguments);};com.sap.fioribi.components.dialogsave.DialogSaveView.prototype=jQuery.sap.newObject(com.sap.fioribi.modules.common.BILPView.prototype);com.sap.fioribi.components.dialogsave.DialogSaveView.prototype.getControllerName=function(){return"com.sap.fioribi.components.dialogsave.DialogSaveController";};com.sap.fioribi.components.dialogsave.DialogSaveView.prototype.createContent=function(oController){jQuery.sap.includeStyleSheet("com/sap/fioribi/css/Dialog.css");jQuery.sap.includeStyleSheet("com/sap/fioribi/css/CustomHeader.css");jQuery.sap.includeStyleSheet("com/sap/fioribi/css/Common.css");$this=this;this.oSaveDialog=new sap.m.Dialog().addStyleClass("BILP-SaveAs sapUiSizeCompact");this.oSaveDialog.setVerticalScrolling(true);var saveBtn;var generalTabLayout=new sap.ui.layout.VerticalLayout();var AdvanceOptionsTabLayout=new sap.ui.layout.VerticalLayout();var generalTab=new sap.m.IconTabFilter({text:BILaunchpadApp.localized("history_general"),content:[generalTabLayout]});var AdvanceOptionsTab=new sap.m.IconTabFilter({text:BILaunchpadApp.localized("advance_options"),content:[AdvanceOptionsTabLayout]});this.topLayout=new sap.m.VBox();this.documentLabelBox=new sap.m.HBox().addStyleClass("BILP-Labelbox");this.documentLabel=new sap.m.Label({text:BILaunchpadApp.localized("Folder_Name")+":"});this.documentTitleLabelValue=new sap.m.Input({value:this.sTitle,liveChange:function(oEvent){var value=oEvent.getSource().getValue();var isEnabled=!!(value&&(value!==""));saveBtn.setEnabled(isEnabled);}}).addStyleClass("BILP-widthvalue");this.documentLabelBox.addItem(this.documentLabel);this.documentLabelBox.addItem(this.documentTitleLabelValue);this.topLayout.addItem(this.documentLabelBox);this.dropdownBox=new sap.m.HBox().addStyleClass("BILP-DialogField BILP-Labelbox2 BILP-widthvalue");this.dropdownLabel=new sap.m.Label({text:BILaunchpadApp.localized("text_Type")+":"}).addStyleClass("BILP-Labelwidth");this.dropdown=new sap.m.Select().addStyleClass(" BILP-widthvalue");this.oModel=new sap.ui.model.json.JSONModel();var oItemTemplate=new sap.ui.core.Item({key:"{key}",text:"{text}"});this.dropdown.setModel(this.oModel);this.dropdown.bindAggregation("items",{path:"/items",template:oItemTemplate});this.dropdown.bindProperty("selectedKey",{path:"/selectedKey",type:new sap.ui.model.odata.type.String()});this.dropdownBox.addItem(this.dropdownLabel);this.dropdownBox.addItem(this.dropdown);this.topLayout.addItem(this.dropdownBox);generalTabLayout.addContent(this.topLayout);this.otoolBar=new sap.m.Bar().addStyleClass("BILP-dialogToolBar");var oTopBarPopover=new sap.m.ResponsivePopover({showHeader:true,placement:"Bottom",contentWidth:"320px",enableScrolling:false,title:BILaunchpadApp.localized("Placeholder_newfolder"),endButton:new sap.m.Button({text:BILaunchpadApp.localized("text_Cancel"),press:function(){oTopBarPopover.close();oTopBarPopover.destroyContent();}}),});var folder_save=new sap.m.Button({text:BILaunchpadApp.localized("text_Save"),enabled:false,press:function(){var name=$this.name1;var description="";var keywords="";oController.createFolder(oController.currentParentID,$this.name1,description,keywords);$this.name1="";folder_save.setEnabled(false);oTopBarPopover.close();oTopBarPopover.destroyContent();}});oTopBarPopover.setBeginButton(folder_save);var add1Icon=new sap.m.Button({icon:"sap-icon://add",tooltip:BILaunchpadApp.localized("add"),press:(function(){var oLayout=new sap.ui.layout.Grid({}).addStyleClass("sapUiSizeCompact BILP-Addlayout");var documentTitle=new sap.m.Label({text:BILaunchpadApp.localized("Folder_Name")+": "}).addStyleClass("BILP-labelpadding");var documentTitleLabelValue=new sap.m.Input({liveChange:function(oEvent){$this.name1=oEvent.getSource().getValue();if($this.name1==""){folder_save.setEnabled(false);}else{folder_save.setEnabled(true);}}});var documentDesc=new sap.m.Label({text:BILaunchpadApp.localized("Folder_Description")+": "}).addStyleClass("BILP-labelpadding");var documentKeywords=new sap.m.Label({text:BILaunchpadApp.localized("Folder_Keywords")+": "}).addStyleClass("BILP-labelpadding");var documentDescLabelValue=new sap.m.Input({change:function(oEvent){description=oEvent.getSource().getProperty("value");}});var documentKeywordsLabelValue=new sap.m.Input({change:function(oEvent){keywords=oEvent.getSource().getProperty("value");}});oLayout.addContent(documentTitle,documentTitleLabelValue);oLayout.addContent(ValuedocumentKeywords,documentKeywordsLabelValue);oLayout.addContent(ValuedocumentDesc,documentDescLabelValue);oTopBarPopover.addContent(oLayout);oTopBarPopover.addStyleClass("sapUiSizeCompact BILP-Addlayout");oTopBarPopover.openBy(this);})}).addStyleClass(" BILP-Refreshicon");var refreshIcon=new sap.m.Button({icon:"sap-icon://refresh",tooltip:BILaunchpadApp.localized("refresh"),press:(function(){oController.updateList(oController.currentParentID);})}).addStyleClass("BILP-size32px BILP-Refreshicon");this.otoolBarLabel=new sap.m.Title({text:BILaunchpadApp.localized("location"),level:sap.ui.core.TitleLevel.H5}).addStyleClass("sapUiSizeCompact BILP-toolbarPadding");this.otoolBaraddIcon=add1Icon;this.otoolBarRefreshIcon=refreshIcon;this.otoolBar.addContentLeft(this.otoolBarLabel);this.otoolBar.addContentRight(this.otoolBarRefreshIcon);this.otoolBar.addContentRight(this.otoolBaraddIcon);var folderTreelist=new sap.m.VBox().addStyleClass("BILP-treePadding sapUiSizeCompact");var myfoldersheader=new sap.m.HBox().addStyleClass("folderbox_color sapUiSizeCompact");var publicfoldersheader=new sap.m.HBox().addStyleClass("sapUiSizeCompact");this.folderTree=new sap.ui.commons.Tree({height:"100%",showHeader:false,enableScrolling:true,}).addStyleClass("BILP-dialogtree BILP-treeContainer");this.nodeTemplate=new sap.ui.commons.TreeNode({text:"{name}",icon:"sap-icon://folder",hasExpander:true,isSelected:false,expanded:{path:"expanded",formatter:function(expanded){if(expanded!=true){return false;}}},enableScrolling:true,selected:$.proxy(function(obj){var id=" ";var src=obj.getSource();var objPath=src.getBindingContext().getPath();var sCUID=src.getModel().getProperty(objPath).cuid;var name=src.getModel().getProperty(objPath).name;if(sCUID==23||sCUID==""){this.getController().resetPathModels();id=sCUID;this.getController().updateBreadcrumbAdd(sCUID,name,id);}else{id=src.getModel().getProperty(objPath).id;this.getController().resetPathModels();this.getController().getFolderInfo(id);}this.getController().updateList(sCUID);},this),toggleOpenState:$.proxy(function(obj){if(obj.getParameters().opened==true){var src=obj.getSource();var objPath=src.getBindingContext().getPath();var sCUID=src.getModel().getProperty(objPath).cuid;this.getController().expandTree(objPath,sCUID);}else{var src=obj.getSource();src.collapse(true,true);}},this)}).addStyleClass("BILP-alignicon");this.folderTree.setModel(this.getController().ofolderModel);this.folderTree.bindAggregation("nodes",{path:"/entries",template:this.nodeTemplate,parameters:{arrayNames:["entries"]}});var oBreadCrumbs=new sap.m.Breadcrumbs();oBreadCrumbs.setModel(this.getController().oPathModel);oBreadCrumbs.addStyleClass("BILP-SaveasBreadcrumbs");var linkTemplate=new sap.m.Link({text:"{name}",href:"javascript:void(0)",customData:[new sap.ui.core.CustomData({key:"cuid",writeToDom:false,value:"{cuid}"})],press:$.proxy(function(oEvent){var name=oEvent.getSource().mProperties.text;var cuid=oEvent.getSource().data("cuid");var objPath=oEvent.getSource().getBindingContext().getPath();oController.updateListByBreadcrumb(cuid,name,objPath);$(".BILP-CloseDialog").hide();},this)}).addStyleClass("BILP-foldersHeader");oBreadCrumbs.bindAggregation("links",{path:"/entries",template:linkTemplate});jQuery.sap.require("com.sap.fioribi.utils.iconImage");var list=new sap.m.List();list.setModel(this.getController().olistModel);list.bindAggregation("items","/entries",function(sId,oContext){var name=oContext.getProperty("name");var type=oContext.getProperty("type");var folderBox=new sap.m.HBox();var iconImage=new sap.m.Image({height:"32px",width:"32px",src:"com/sap/fioribi/images/icons-with-type.png",backgroundRepeat:"no-repeat",backgroundSize:"initial",mode:sap.m.ImageMode.Background,backgroundPosition:updatedicon(type),});var title=new sap.m.Text({text:name,}).addStyleClass("BILP-titlePadding");var folderBox=new sap.m.HBox({items:[iconImage,title]});var listTemplate=new sap.m.CustomListItem({content:folderBox,tooltip:name,type:{path:"type",formatter:function(type){if(type=="Folder"){return sap.m.ListType.Active;}else{return sap.m.ListType.Inactive;}}},press:$.proxy(function(obj){var src=obj.getSource();var objPath=src.getBindingContext().getPath();var sCUID=src.getModel().getProperty(objPath).cuid;var name=src.getModel().getProperty(objPath).name;var id=src.getModel().getProperty(objPath).id;var Type=src.getModel().getProperty(objPath).type;if(Type=="Folder"){oController.updateBreadcrumbAdd(sCUID,name,id);oController.updateList(sCUID);}if(sCUID==23){saveBtn.setEnabled(false);}},this)}).addStyleClass("BILP-listItem BILP-treeIcon");return listTemplate;});var listBox=new sap.m.VBox({layoutData:new sap.ui.layout.SplitterLayoutData({size:"50%",resizable:false})}).addStyleClass("BILP-Breadcrumbs");listBox.addItem(oBreadCrumbs);listBox.addItem(list);this.bottomLayout=new sap.ui.layout.Splitter({contentAreas:[this.folderTree,listBox]}).addStyleClass("BILP-bottomSplitterLayout1");generalTabLayout.addContent(this.otoolBar);generalTabLayout.addContent(this.bottomLayout);this.oCustomContentPanel=new sap.m.Panel({expanded:true,expandable:false,visible:true,}).addStyleClass("sapMFilterPadding sapUiSizeCompact");AdvanceOptionsTabLayout.addContent(this.oCustomContentPanel);var $this=this;var found=false;var CategoryTreelist=new sap.m.VBox().addStyleClass("BILP-treePadding sapUiSizeCompact");var personalcategoriesheader=new sap.m.HBox().addStyleClass("folderbox_color sapUiSizeCompact");var corporatecategoriesheader=new sap.m.HBox().addStyleClass("sapUiSizeCompact");this.Categorieslist=new sap.ui.commons.layout.VerticalLayout({height:"250px",});this.categoryTree=new sap.ui.commons.Tree({height:"100%",showHeader:false,enableScrolling:true,}).addStyleClass("BILP-dialogtree BILP-treeContainer");this.categorynodeTemplate=new sap.ui.commons.TreeNode({text:"{name}",icon:"sap-icon://dimension",hasExpander:true,expanded:false,isSelected:"{selectedflag}",enableScrolling:true,selected:$.proxy(function(obj){var id=" ";var src=obj.getSource();var objPath=src.getBindingContext().getPath();if(objPath=="/entries/0"){this.Categorieslist.setModel(this.getController().oModel.getPersonalCategories());}else{if(objPath=="/entries/1"){this.Categorieslist.setModel(this.getController().oModel.getCorporateCategories());}else{var sCUID=src.getModel().getProperty(objPath).cuid;var name=src.getModel().getProperty(objPath).name;this.getController().updateCategoryList(sCUID);this.Categorieslist.setModel(this.getController().oModel.getCategoriesList());}}},this),toggleOpenState:$.proxy(function(obj){if(obj.getParameters().opened==true){var src=obj.getSource();var objPath=src.getBindingContext().getPath();if(objPath=="/entries/0"){this.getController().expandRootTree(objPath);}else{if(objPath=="/entries/1"){this.getController().expandRootTree(objPath);}else{var sCUID=src.getModel().getProperty(objPath).cuid;this.getController().expandCategoriesTree(objPath,sCUID);}}}else{var src=obj.getSource();src.collapse(true,true);}},this)}).addStyleClass("BILP-alignicon");var categoriesList=this.getController().oModel.getPersonalCategories();this.Categorieslist.setModel(categoriesList);this.categoryTree.setModel(this.getController().oCategoryModel);this.categoryTree.bindAggregation("nodes",{path:"/entries",template:this.categorynodeTemplate,parameters:{arrayNames:["entries"]}});this.Categorieslist.bindAggregation("content","/entries",function(sId,oContext){var templateCheck=new sap.m.CheckBox({text:"{name}",tooltip:"{name}",selected:"{selected}",select:function(obj){if(obj.getParameters().selected){var src=obj.getSource();var objPath=src.getBindingContext().getPath();var selectedCategory=src.getModel().getProperty(objPath);$this.oController.setSelectedTokens(selectedCategory);}else{found=false;var src=obj.getSource();var path=src.getBindingContext().getPath();var removedCategory=src.getModel().getProperty(path);var oJsonModel=$this.getController().selectedTokensModel;var aData=oJsonModel.getProperty("/entries");var oSize=aData.length;if(oSize!=0){for(var i=0;i<oSize;i++){if(aData[i].cuid==removedCategory.cuid){var d=aData.splice(i,1);found=true;}}oJsonModel.setProperty("/entries",aData);}if(found!=true){$this.oController.setRemovedTokens(removedCategory);}}}});return templateCheck;});this.advancedtabbottomLayout=new sap.ui.layout.Splitter({contentAreas:[this.categoryTree,this.Categorieslist]}).addStyleClass("BILP-bottomSplitterLayout2");AdvanceOptionsTabLayout.addContent(this.advancedtabbottomLayout);this.oSaveasdialogTab=new sap.m.IconTabBar({items:[generalTab,AdvanceOptionsTab]});this.oSaveDialog.addContent(this.oSaveasdialogTab);this.oSaveDialog.addStyleClass("BILP-savedialogheader");var clsBtn=new sap.m.Button({text:BILaunchpadApp.localized("text_Cancel"),press:function(){$this.oSaveDialog.close();}});var saveBtn=new sap.m.Button({text:BILaunchpadApp.localized("text_Save"),press:function(){var selectedTokens=$this.oController.selectedTokensModel.getProperty("/entries");var sizeSelectedTokens=selectedTokens.length;var list=[];if(sizeSelectedTokens!=0){for(i=0;i<sizeSelectedTokens;i++){data={id:selectedTokens[i].cuid,};list.push(data);}var reqbody={entries:list};}var removedTokens=$this.oController.removedTokensModel.getProperty("/entries");var sizeRemovedTokens=removedTokens.length;var list=[];if(sizeRemovedTokens!=0){for(i=0;i<sizeRemovedTokens;i++){data={id:removedTokens[i].cuid,};list.push(data);}var reqbody={entries:list};}var name=$this.documentTitleLabelValue.getValue();var parentId=$this.getController().currentParentID;var customParams=$this.oCustomContent.getModel().getData();oController.saveAs(name,$this.dropdown.getSelectedKey(),parentId,customParams,selectedTokens,removedTokens);}});this.oSaveDialog.addButton(saveBtn);this.oSaveDialog.addButton(clsBtn);this.oSaveDialog.setTitle(BILaunchpadApp.localized("Text_save_as"));};com.sap.fioribi.components.dialogsave.DialogSaveView.prototype.initState=function(){this.documentTitleLabelValue.setValue(this.sTitle);this.oCustomContentPanel.setExpanded(true);};com.sap.fioribi.components.dialogsave.DialogSaveView.prototype.setTitle=function(sTitle){this.sTitle=sTitle;this.documentTitleLabelValue.setValue(this.sTitle);};com.sap.fioribi.components.dialogsave.DialogSaveView.prototype.setFolderId=function(sFolderId){this.sFolderId=sFolderId;this.oController.getFolderInfo(sFolderId);};com.sap.fioribi.components.dialogsave.DialogSaveView.prototype.setTypeObj=function(oData){this.oModel.setData(oData);};com.sap.fioribi.components.dialogsave.DialogSaveView.prototype.showDialog=function(){this.oSaveDialog.open();};com.sap.fioribi.components.dialogsave.DialogSaveView.prototype.closeDialog=function(){this.oSaveDialog.close();};com.sap.fioribi.components.dialogsave.DialogSaveView.prototype.addCustomContent=function(content,sHeaderText,bExpand){if(content!=null){this.oCustomContent=content;this.oCustomContentPanel.setVisible(true);if(bExpand!=null){this.oCustomContentPanel.setExpanded(bExpand);}this.oCustomContentPanel.addContent(content);}};
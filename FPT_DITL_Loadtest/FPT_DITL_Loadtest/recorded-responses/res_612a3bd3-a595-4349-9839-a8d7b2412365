/*
ï¿½2010 - 2016 SAP SE or an SAP affiliate company.  All rights reserved.
 
SAP and other SAP products and services mentioned herein as well as their respective logos are trademarks or registered trademarks of SAP SE in Germany and other countries.  Please see http://www.sap.com/corporate-en/legal/copyright/index.epx#trademark for additional trademark information and notices.
*/

jQuery.sap.declare({modName:"com.sap.fioribi.components.overviewpage.DocumentsView",type:"view"});jQuery.sap.require({modName:"com.sap.fioribi.modules.common.BILPView",type:"view"});jQuery.sap.require("com.sap.fioribi.widgets.Table");com.sap.fioribi.components.overviewpage.DocumentsView=function(){com.sap.fioribi.modules.common.BILPView.apply(this,arguments);BILaunchpadApp.includeStyleSheet("com/sap/fioribi/css/SmartFilterBar.css");};com.sap.fioribi.components.overviewpage.DocumentsView.prototype=jQuery.sap.newObject(com.sap.fioribi.modules.common.BILPView.prototype);com.sap.fioribi.components.overviewpage.DocumentsView.prototype.getControllerName=function(){return"com.sap.fioribi.components.overviewpage.DocumentsController";};com.sap.fioribi.components.overviewpage.DocumentsView.prototype.handlePress=function(e,oController,actId){var objectScheduleContext={children:"0",created:"",cuid:"",description:"",displaytype:"BI Workspace",fav:true,filter:"home_myfavorites",headerIconClass:"BILP-size32px BILP-Webi",icon:"",id:"Schedules",imagepath:"",instances:"0",keywords:"",lastRef:"",lastRun:"",name:BILaunchpadApp.localized("instances"),opendocurl:"",owner:"Administrator",parentcuid:"",parentid:"",tileType:"doc",type:"AFDashboardPage",updated:"",dcoViewId:""};if(e!=null){src=e.getSource();}var objContext=this.data().context;if(!objContext){objContext={getProperty:function(obj){return objectScheduleContext;},getPath:function(){return objectScheduleContext;}};}sap.ui.core.BusyIndicator.show(0);setTimeout(function(){oController.fnViewDocument(objContext);sap.ui.core.BusyIndicator.hide();},10);};com.sap.fioribi.components.overviewpage.DocumentsView.prototype.handleFooterPress=function(e,oController,actId){BILaunchpadApp.setFooterStatus(true);var $view=this;var customObjContext={children:"0",contentImageSrc:"",reportenginetype:"",count:"",created:"",cuid:"",description:"",displaytype:"BI Workspace",fav:true,filter:"home_myfavorites",headerIconClass:"BILP-size32px BILP-Webi",icon:"",id:"Documents",imagepath:"",instances:"0",keywords:"",lastRef:"",lastRun:"",opendocurl:"",owner:"Administrator",parentcuid:"",parentid:"",tileType:"doc",type:"AFDashboardPage",updated:"",docViewId:actId};if(actId=="2"){customObjContext.name=BILaunchpadApp.localized("recent_documents");}else{if(actId=="5"){customObjContext.name=BILaunchpadApp.localized("my_favourites");}else{customObjContext.name="Recently Run Documents";customObjContext.id="Schedules";}}var src;if(e!=null){src=e.getSource();}var objContext=this.data().context;if(!objContext){objContext={getProperty:function(obj){return customObjContext;},getPath:function(){return customObjContext;}};}oController.fnViewDocument(objContext);};com.sap.fioribi.components.overviewpage.DocumentsView.prototype.createContent=function(oController){var $view=this;var uiElementMap=new Map();BILaunchpadApp.includeStyleSheet("com/sap/fioribi/css/Common.css");if(BILaunchpadApp.getRtlFlag()==false){BILaunchpadApp.includeStyleSheet("com/sap/fioribi/css/Homepage.css");}else{BILaunchpadApp.includeStyleSheet("com/sap/fioribi/css/Homepage_rtl.css");}this.oLink=new sap.ui.layout.VerticalLayout({}).addStyleClass("BILP-tableHeader1 BILP-WidthIE");this.tilePage=new sap.m.Page({showFooter:false}).addStyleClass("BILP-tileSpecificPadding");uiElementMap.set("tilePage",this.tilePage);this.tilePage.setShowHeader(false);var that=this;this.listPage=new sap.m.Page({}).addStyleClass("BILP-tableSpecificPadding");uiElementMap.set("listPage",this.listPage);this.listPage.setShowHeader(false);this.listPage.setEnableScrolling(false);var oController=this.getController();var HomePageFilter;var isCatCallback=findCallback("callbackGetisCat");if(isCatCallback!=null){var isCat=isCatCallback();if(isCat&&isCat!="null"){var startFolderCallback=findCallback("callbackGetStartFolder");var startFolder;if(startFolderCallback!=null){startFolder=startFolderCallback();}if(startFolder&&startFolder!="null"&&isCat=="true"){HomePageFilter="4";}else{HomePageFilter=BILaunchpadApp.getHomePageFilter();}}else{HomePageFilter=BILaunchpadApp.getHomePageFilter();}}HomePageFilter=BILaunchpadApp.getCurrentSection();switch(HomePageFilter){case"1":oController.getShowAll();break;case"2":oController.getRecent();break;case"3":oController.getDocuments();break;case"4":oController.getCategories();break;case"5":oController.getFavorites();break;case"6":oController.getMyRecentlyRun();break;default:oController.getShowAll();}var tileModelDoc=this.getController().model.getdocumentTileList();var pagePrefModel=sap.ui.getCore().getModel("pagePrefModel");var flag=this.getController().model.getselectedFilter().oData.flag;var oController=this.getController();tileModelDoc.setSizeLimit(100000);jQuery.sap.require("com.sap.fioribi.utils.Pagination");var oPagination=new com.sap.fioribi.utils.Pagination();var tileList=this.getController().model.getdocumentTileList();BILaunchpadApp.includeStyleSheet("com/sap/fioribi/css/GenericTile.css");jQuery.sap.require("com.sap.fioribi.widgets.GenericTile");var oCallback={oListBox:this.oListBox,oController:this.getController()};var oBICustomTile=new com.sap.fioribi.widgets.GenericTile({icon:"{icon}",cuid:"{cuid}",objectName:"{name}",count:"{count}",kind:"{type}",contentImageSrc:"{contentImageSrc}",reportenginetype:"{reportenginetype}",lastRef:"{lastRef}",fav:"{fav}",schedulestatus:"{uistatus}",iconstatus:"{iconstatus}",isinstance:"{isinstance}",callBackObj:oCallback});oBICustomTile.addStyleClass("BILP-BICustomTile");var favtilemodel=new sap.ui.model.json.JSONModel([]);var homePagePref=sap.ui.getCore().getModel("homePagePrefModel");var favouritesTileOrderArr=homePagePref.favouritesTileOrder.split(",");favtilemodel.setData(tileList);sap.ui.getCore().setModel(favtilemodel,"/entries");var data=sap.ui.getCore().getModel("/entries");if(data){data=data.oData.oData.entries;var favouriteMap={};var nonOrderedTileArr=[];for(counter=0;counter<data.length;counter++){var tileData=data[counter];if(tileData!==null){favouriteMap[tileData.cuid]=tileData;}if(favouritesTileOrderArr!=undefined&&favouritesTileOrderArr!=null&&favouritesTileOrderArr!=""&&!homePagePref.favouritesTileOrder.includes(tileData.cuid)){nonOrderedTileArr.push(tileData.cuid);}}var jsonFavouriteOrderedTiles=[];if(favouritesTileOrderArr!=undefined&&favouritesTileOrderArr!=null&&favouritesTileOrderArr!=""&&BILaunchpadApp.getCurrentSection()=="5"){for(i=0;i<favouritesTileOrderArr.length;i++){if(favouriteMap[favouritesTileOrderArr[i].split("__")[0]]!=undefined){jsonFavouriteOrderedTiles.push(favouriteMap[favouritesTileOrderArr[i].split("__")[0]]);}}for(i=0;i<nonOrderedTileArr.length;i++){if(favouriteMap[nonOrderedTileArr[i].split("__")[0]]!=undefined){jsonFavouriteOrderedTiles.push(favouriteMap[nonOrderedTileArr[i].split("__")[0]]);}}data=jsonFavouriteOrderedTiles;}}var counter;var jsonMetaDataBind=[];var totalTile=data.length;var totalWidth=Math.round(document.body.offsetWidth);var noOfTiles=totalWidth/205;noOfTiles=Math.floor(noOfTiles);var tilesCount=0;var visibleTileCount=0;var actualTilesCount=0;var actualBrowserTiles=noOfTiles;if(BILaunchpadApp.getCurrentSection()=="5"){if(totalTile<noOfTiles){noOfTiles=totalTile;}for(var tile=0;tile<noOfTiles;tile++){if(data[tile].type=="PersonalCategory"||data[tile].type=="Category"){tilesCount=tilesCount+2;actualTilesCount=actualTilesCount+1;}else{tilesCount++;actualTilesCount=actualTilesCount+1;}if(actualBrowserTiles>=tilesCount){visibleTileCount=actualTilesCount;}}noOfTiles=visibleTileCount;}if(totalTile>noOfTiles){totalTile=noOfTiles;}else{noOfTiles=totalTile;}for(counter=0;counter<totalTile;counter++){if(counter<noOfTiles){var tileData=data[counter];if(tileData!==null){jsonMetaDataBind.push(tileData);favouriteMap[tileData.cuid]=tileData;}}}if((totalTile>=1)&&(!BILaunchpadApp.getFooterStatus())){var footerText="";var actId="";var sectionId=BILaunchpadApp.getCurrentSection();switch(sectionId){case"2":footerText=BILaunchpadApp.localized("recent_documents_Footer_Button");actId=sectionId;break;case"5":footerText=BILaunchpadApp.localized("favorites_Footer_Button");actId=sectionId;break;case"6":footerText=footerText=BILaunchpadApp.localized("recent_Run_Footer_Button");actId=sectionId;}var width=((11*totalTile)+(totalTile/2));for(var tile=0;tile<totalTile;tile++){if(data[tile].type=="PersonalCategory"||data[tile].type=="Category"){width=width+10;}}width=width+"rem";var sectionFooter=new sap.m.Toolbar({content:[new sap.m.Button({text:footerText,width:width,press:function(event){if(actId=="6"){$view.handlePress(event,oController,actId);}else{BILaunchpadApp.setListingType("listview");$view.handleFooterPress(event,oController,actId);}}})]}).addStyleClass("FavFooterPadding BILP-tileSpecificPadding");sectionFooter.addStyleClass("Footer");totalTile=data.length;if(totalTile>=4){this.tilePage.setFooter(sectionFooter);this.tilePage.setShowFooter(true);}this.oTileContainer=new sap.m.ScrollContainer({vertical:false}).addStyleClass("BILP-Height100Perc BILP-scrollMargin");var editedJsonModel=new sap.ui.model.json.JSONModel([]);var editedJsonData={entries:jsonMetaDataBind};editedJsonModel.setData(editedJsonData);this.oTileContainer.bindAggregation("content","/entries",oBICustomTile);this.oTileContainer.setModel(editedJsonModel);this.tilePage.setShowHeader(false);this.tilePage.addStyleClass("BILP-Scrollbar");var oController=this.getController();tileList.setSizeLimit(100000);jQuery.sap.require("com.sap.fioribi.utils.Pagination");var oPagination=new com.sap.fioribi.utils.Pagination();if(totalTile>=4){this.oTileContainer.addContent(sectionFooter);}}else{var noDocsText=" ";if(BILaunchpadApp.getCurrentSection()=="5"){noDocsText=BILaunchpadApp.localized("no_Favorites_Text");}if(BILaunchpadApp.getCurrentSection()=="2"){noDocsText=BILaunchpadApp.localized("no_Recent_Docs_Text");}if(BILaunchpadApp.getCurrentSection()=="6"){noDocsText=BILaunchpadApp.localized("no_Recent_Run_Text");}var label=new sap.m.Toolbar({content:[new sap.m.Button({text:noDocsText,width:"100%"})]}).addStyleClass("BILP-NoItemsTextHomePage");var buttonnodata=new sap.m.Button({text:noDocsText,width:width,}).addStyleClass("BILP-NoItemsButtonHomePage");var sectionFooter=new sap.m.Toolbar({content:[buttonnodata]});this.oTileContainer=new sap.m.ScrollContainer({vertical:false,content:[sectionFooter]}).addStyleClass("BILP-Height100Perc BILP-scrollMargin");jQuery.sap.require("com.sap.fioribi.utils.Pagination");var oPagination=new com.sap.fioribi.utils.Pagination();}var toolbar=new sap.m.Bar().addStyleClass("BILP-transparent BILP-headerShadow BILP-tabLabel BILP-toolbarmargin");var breadcrumbBar=new sap.m.Bar().addStyleClass("BILP-breadcrumb BILP-transparent BILP-headerShadow BILP-tabLabel BILP-bdCrumb");this.setCategoryFilter={flag:1};this.setOtherFilter={flag:0};this.oTableWidget;uiElementMap.set("ListBox",this.oListBox);var Label=new sap.m.Text({text:BILaunchpadApp.localized("show_all")});var typeParent=this.oController.model.getpageInfo().oData.type;jQuery.sap.require("com.sap.fioribi.components.categories.CreateCategoryContainer");var createPopover=new sap.m.Popover({showHeader:false,placement:"Bottom",enableScrolling:false,});BILaunchpadApp.setDocViewUIelementMap(uiElementMap);return that.oTileContainer;};
/*
ï¿½2010 - 2016 SAP SE or an SAP affiliate company.  All rights reserved.
 
SAP and other SAP products and services mentioned herein as well as their respective logos are trademarks or registered trademarks of SAP SE in Germany and other countries.  Please see http://www.sap.com/corporate-en/legal/copyright/index.epx#trademark for additional trademark information and notices.
*/

jQuery.sap.declare({modName:"com.sap.fioribi.components.categories.CreateCategoryController",type:"controller"});jQuery.sap.require({modName:"com.sap.fioribi.modules.common.BILPController",type:"controller"});com.sap.fioribi.components.categories.CreateCategoryController=function(){com.sap.fioribi.modules.common.BILPController.apply(this,arguments);this.oParentController=null;this.typeParent=null;};com.sap.fioribi.components.categories.CreateCategoryController.prototype=jQuery.sap.newObject(com.sap.fioribi.modules.common.BILPController.prototype);com.sap.fioribi.components.categories.CreateCategoryController.prototype.onInit=function(){};com.sap.fioribi.components.categories.CreateCategoryController.prototype.setParentController=function(oParentController,oTypeParent){this.oParentController=oParentController;this.typeParent=oTypeParent;};com.sap.fioribi.components.categories.CreateCategoryController.prototype.createCategory=function(name1,desc,tags,kind,file){var that=this;var reqDispatcher=new RequestDispatcher();if((this.oParentController.currentParentID==Number(this.oParentController.currentParentID))==false){var testCuid=this.oParentController.currentParentID;}else{var testCuid=this.oParentController.model.getpageInfo().oData.cuid;}if(testCuid==null){if(kind=="PersonalCategory"||kind=="personal_category"){var testCuid=this.oParentController.favoriteFolderID;}else{var testCuid=BILaunchpadApp.oConstants.CORPORATE_CATEGORY_ID;}}var level=BILaunchpadApp.getCurrentSection();if(file=="null"||file=="undefined"){if(kind=="PersonalCategory"||kind=="personal_category"){file=BILaunchpadApp.getBaseURL()+"com/sap/fioribi/images/personal-category.png";}else{file=BILaunchpadApp.getBaseURL()+"com/sap/fioribi/images/corporate-category.png";}}if(kind=="PersonalCategory"||kind=="personal_category"){categoryDetails={name:name1,parentid:testCuid,description:desc,keywords:tags,imagepath:file,type:"personal"};}else{categoryDetails={name:name1,parentid:testCuid,description:desc,keywords:tags,imagepath:file,type:"corporate",};}var createError=function(xhr,ajaxOptions,thrownError){var errorMsg=xhr.message.toString();var AccesRightsDeniedToAddFoldersCode="you do not have the right to";if(errorMsg.indexOf(AccesRightsDeniedToAddFoldersCode)!==-1){xhr.message=BILaunchpadApp.localized("AccesRightsDeniedToAddFolders");}var clsBtn=new sap.m.Button({text:BILaunchpadApp.localized("Recycle_Bin_Close"),press:$.proxy(function(){errDialog.close();},this)});var errDialog=new sap.m.Dialog().addButton(clsBtn);errDialog.open();errDialog.setTitle(BILaunchpadApp.localized("Error"));BILaunchpadApp.oErrorHandler.showErrorMessage(xhr,errDialog);bError=true;sap.ui.core.BusyIndicator.hide();};var createSuccess=function(response){sap.m.MessageToast.show(BILaunchpadApp.localized("new_category")+" '"+name1+"' "+BILaunchpadApp.localized("Folder_created"),{autoClose:true});if(testCuid==""){if(level==4){that.oParentController.getCategories();}}else{that.oParentController.updateTable(testCuid);}sap.ui.core.BusyIndicator.hide();if(that.oParentController.getView().oTableWidget!=null){that.oParentController.getView().oTableWidget.clearFilters();}};var request={surl:BILaunchpadApp.getWebServiceBaseURL()+"/v1/categories/category",reqType:"POST",successHandler:createSuccess,errorHandler:createError,data:JSON.stringify(categoryDetails),headers:{"x-SAP-logonToken":BILaunchpadApp.getlogonToken(),Accept:"application/json","Content-Type":"application/json;odata=verbose",}};sap.ui.core.BusyIndicator.show(0);reqDispatcher.sendRequest(request);};com.sap.fioribi.components.categories.CreateCategoryController.prototype.processCAFActions=function(cafType,objData){var scheduleHandler=BILaunchpadApp.oClientActionHandler.getCAFHandler(cafType,objData.type);scheduleHandler.renderPage(objData);};
/*
ï¿½2010 - 2016 SAP SE or an SAP affiliate company.  All rights reserved.
 
SAP and other SAP products and services mentioned herein as well as their respective logos are trademarks or registered trademarks of SAP SE in Germany and other countries.  Please see http://www.sap.com/corporate-en/legal/copyright/index.epx#trademark for additional trademark information and notices.
*/

jQuery.sap.declare({modName:"com.sap.fioribi.modules.logonpageBI.LogonpageBIController",type:"controller"});jQuery.sap.require({modName:"com.sap.fioribi.modules.common.BILPController",type:"controller"});com.sap.fioribi.modules.logonpageBI.LogonpageBIController=function(){com.sap.fioribi.modules.common.BILPController.apply(this,arguments);};com.sap.fioribi.modules.logonpageBI.LogonpageBIController.prototype=jQuery.sap.newObject(com.sap.fioribi.modules.common.BILPController.prototype);com.sap.fioribi.modules.logonpageBI.LogonpageBIController.prototype.onInit=function(){};com.sap.fioribi.modules.logonpageBI.LogonpageBIController.prototype.initSettings=function(){this.initLocaleAndTimeZones();this.initPagePreferences();};com.sap.fioribi.modules.logonpageBI.LogonpageBIController.prototype.initAllSettings=function(data){var reqDispatcher=new RequestDispatcher();var setLocale=function(jsonData){var pref="false";var localeMap=new Map([["af","af_ZA"],["am","am_ET"],["ar","ar_DZ"],["arn","arn_CL"],["as","as_IN"],["az","az_Latn_AZ"],["ba","ba_RU"],["be","be_BY"],["bg","bg_BG"],["bn","bn_BD"],["bo","bo_CN"],["br","br_FR"],["bs","bs_Latn_BA"],["ca","ca_ES"],["co","co_FR"],["cs","cs_CZ"],["cy","cy_GB"],["da","da_DK"],["de","de_DE"],["dsb","dsb_DE"],["dv","dv_MV"],["el","el_GR"],["en","en_US"],["es","es_ES"],["et","et_EE"],["eu","eu_ES"],["fa","fa_IR"],["fi","fi_FI"],["fil","fil_PH"],["fo","fo_FO"],["fr","fr_FR"],["fy","fy_NL"],["ga","ga_IE"],["sd","gd_GB"],["gl","gl_ES"],["gsw","gsw_FR"],["gu","gu_IN"],["ha","ha_Latn_NG"],["he","he_IL"],["hi","hi_IN"],["hr","hr_HR"],["hsb","hsb_DE"],["hu","hu_HU"],["hy","hy_AM"],["id","id_ID"],["ig","ig_NG"],["ii","ii_CN"],["is","is_IS"],["it","it_IT"],["iu","iu_Latn_CA"],["ja","ja_JP"],["ka","ka_GE"],["kk","kk_KZ"],["kl","kl_GL"],["km","km_KH"],["kn","kn_IN"],["kok","kok_IN"],["ko","ko_KR"],["ky","ky_KG"],["lb","lb_LU"],["lo","lo_LA"],["lt","lt_LT"],["lv","lv_LV"],["mi","mi_NZ"],["mk","mk_MK"],["ml","ml_IN"],["mn","mn_MN"],["moh","moh_CA"],["mr","mr_IN"],["ms","ms_MY"],["mt","mt_MT"],["nb","nb_NO"],["ne","ne_NP"],["nl","nl_NL"],["nn","nn_NO"],["nso","nso_ZA"],["oc","oc_FR"],["or","or_IN"],["pa","pa_IN"],["pl","pl_PL"],["prs","prs_AF"],["ps","ps_AF"],["pt","pt_PT"],["qut","qut_GT"],["rm","rm_CH"],["ro","ro_RO"],["ru","ru_RU"],["rw","rw_RW"],["sah","sah_RU"],["sa","sa_IN"],["si","si_LK"],["sk","sk_SK"],["sl","sl_SI"],["smn","smn_FI"],["sms","sms_FI"],["sq","sq_AL"],["sr","sr_Cyrl_CS"],["sv","sv_SE"],["sw","sw_KE"],["syr","syr_SY"],["ta","ta_IN"],["te","te_IN"],["tg","tg_Cyrl_TJ"],["th","th_TH"],["tk","tk_TM"],["tn","tn_ZA"],["tr","tr_TR"],["tt","tt_RU"],["tzm","tzm_Latn_DZ"],["ug","ug_CN"],["uk","uk_UA"],["ur","ur_PK"],["uz","uz_Latn_UZ"],["vi","vi_VN"],["wo","wo_SN"],["xh","xh_ZA"],["yo","yo_NG"],["zh","zh_CN"],["zu","zu_ZA"]]);try{var getPreference=findCallback("callbackGetLocalePreference");pref=getPreference();}catch(e){pref="false";}if(pref=="false"){this.sBrowserLocale=window.navigator.userLanguage||window.navigator.language;if(localeMap.has(this.sBrowserLocale)){this.sLocale=localeMap.get(this.sBrowserLocale);this.sBrowserLocale=this.sLocale.replace("-","_");data.sPVL=this.sBrowserLocale;data.sProductLocale=this.sBrowserLocale;}else{this.sBrowserLocale=this.sBrowserLocale.replace("-","_");data.sPVL=this.sBrowserLocale;data.sProductLocale=this.sBrowserLocale;}}else{data.sPVL="en_US";data.sProductLocale="en_US";}if(jsonData.documentlocale!=""&&jsonData.documentlocale!="1024"&&pref=="false"){data.sPVL=jsonData.documentlocale;}if(jsonData.productlocaledisplaystring!=""&&jsonData.productlocaledisplaystring!="1024"&&pref=="false"){data.sProductLocale=jsonData.productlocaledisplaystring;}data.sTimeZone=jsonData.timezone;data.sTimezonedisplaystring=jsonData.timezonedisplaystring;data.sProductlocaledisplaystring=jsonData.productlocaledisplaystring;sap.ui.getCore().setModel(jsonData,"localePagePrefModel");};var AllSettingsError=function(xhr,ajaxOptions,thrownError){console.log("Unable to get all settings information hence using individual calls");};var setAllSettings=function(response){var jsonModel=new sap.ui.model.json.JSONModel(response);sap.ui.getCore().setModel(jsonModel,"allSettingsModel");setLocale(response.entries[3]);};var request={surl:data.sRestWebServiceURL+"/internal/v1/settings/allsettings?appCuid=Ac7UIwmYafpFuhiiw6FRXLQ",reqType:"GET",bAsync:false,successHandler:setAllSettings,errorHandler:AllSettingsError,headers:{Accept:"application/json","Content-Type":"application/json;odata=verbose","x-sap-logontoken":data.logontoken}};reqDispatcher.sendRequest(request);};com.sap.fioribi.modules.logonpageBI.LogonpageBIController.prototype.initViewRights=function(data){var reqDispatcher=new RequestDispatcher();var setRights=function(response){data.oRightsObj=response;};var rightError=function(xhr,ajaxOptions,thrownError){oRightsObj.alertview=false;oRightsObj.inboxview=false;oRightsObj.favoritefolderview=false;oRightsObj.folderview=false;oRightsObj.recyclebinview=false;console.log("Failed "+xhr.message);console.log("Not able to retrive rights for Inbox/Alerts/Folder/Favoritefolder/Recycle Bin");};var request={surl:data.sRestWebServiceURL+"/internal/v1/settings/myinfo/viewrights",reqType:"GET",bAsync:false,successHandler:setRights,errorHandler:rightError,headers:{Accept:"application/json","Content-Type":"application/json;odata=verbose","x-sap-logontoken":data.logontoken}};var allSettingsModel=sap.ui.getCore().getModel("allSettingsModel");if(!allSettingsModel){reqDispatcher.sendRequest(request);}else{setRights(allSettingsModel.oData.entries[4]);}};com.sap.fioribi.modules.logonpageBI.LogonpageBIController.prototype.initThemeing=function(data){var reqDispatcher=new RequestDispatcher();var setTheme=function(response){if(response.themecolor=="light"){BILaunchpadApp.setCurrentThemeName(BILaunchpadApp.localized("Themes_Belize"));BILaunchpadApp.setTheme(BILaunchpadApp.oConstants.LIGHT_THEME);sap.ui.getCore().applyTheme(BILaunchpadApp.oConstants.LIGHT_THEME);}else{if(response.themecolor=="dark"){BILaunchpadApp.setCurrentThemeName(BILaunchpadApp.localized("Themes_Plus"));BILaunchpadApp.setTheme(BILaunchpadApp.oConstants.DARK_THEME);sap.ui.getCore().applyTheme(BILaunchpadApp.oConstants.DARK_THEME);}else{if(response.themecolor=="contrastBlack"){BILaunchpadApp.setCurrentThemeName(BILaunchpadApp.localized("Themes_HCB"));BILaunchpadApp.setTheme(BILaunchpadApp.oConstants.CONTRASTBLACK_THEME);sap.ui.getCore().applyTheme(BILaunchpadApp.oConstants.CONTRASTBLACK_THEME);}else{if(response.themecolor=="contrastWhite"){BILaunchpadApp.setCurrentThemeName(BILaunchpadApp.localized("Themes_HCW"));BILaunchpadApp.setTheme(BILaunchpadApp.oConstants.CONTRASTWHITE_THEME);sap.ui.getCore().applyTheme(BILaunchpadApp.oConstants.CONTRASTWHITE_THEME);}else{if(response.themecolor=="Quartzlight"){BILaunchpadApp.setCurrentThemeName(BILaunchpadApp.localized("Themes_Quartz_light"));BILaunchpadApp.setTheme(BILaunchpadApp.oConstants.QUARTZ_LIGHT);sap.ui.getCore().applyTheme(BILaunchpadApp.oConstants.QUARTZ_LIGHT);}else{if(response.themecolor=="Quartzdark"){BILaunchpadApp.setCurrentThemeName(BILaunchpadApp.localized("Themes_Quartz_Dark"));BILaunchpadApp.setTheme(BILaunchpadApp.oConstants.QUARTZ_DARK);sap.ui.getCore().applyTheme(BILaunchpadApp.oConstants.QUARTZ_DARK);}else{if(response.themecolor=="QuartzhcB"){BILaunchpadApp.setCurrentThemeName(BILaunchpadApp.localized("Themes_Quartz_HCB"));BILaunchpadApp.setTheme(BILaunchpadApp.oConstants.QUARTZ_HCB);sap.ui.getCore().applyTheme(BILaunchpadApp.oConstants.QUARTZ_HCB);}else{if(response.themecolor=="QuartzhcW"){BILaunchpadApp.setCurrentThemeName(BILaunchpadApp.localized("Themes_Quartz_HCW"));BILaunchpadApp.setTheme(BILaunchpadApp.oConstants.QUARTZ_HCW);sap.ui.getCore().applyTheme(BILaunchpadApp.oConstants.QUARTZ_HCW);}}}}}}}}};var themeError=function(xhr,ajaxOptions,thrownError){console.log("Failed "+xhr.message);};var request={surl:BILaunchpadApp.getWebServiceBaseURL()+"/internal/v1/settings/appearance",reqType:"GET",bAsync:false,successHandler:setTheme,errorHandler:themeError,headers:{Accept:"application/json","Content-Type":"application/json;odata=verbose","x-sap-logontoken":data.logontoken}};var allSettingsModel=sap.ui.getCore().getModel("allSettingsModel");if(!allSettingsModel){reqDispatcher.sendRequest(request);}else{setTheme(allSettingsModel.oData.entries[1]);}};com.sap.fioribi.modules.logonpageBI.LogonpageBIController.prototype.initLocaleAndTimeZones=function(data){var reqDispatcher=new RequestDispatcher();var setLocale=function(jsonData){var pref="false";var localeMap=new Map([["af","af_ZA"],["am","am_ET"],["ar","ar_DZ"],["arn","arn_CL"],["as","as_IN"],["az","az_Latn_AZ"],["ba","ba_RU"],["be","be_BY"],["bg","bg_BG"],["bn","bn_BD"],["bo","bo_CN"],["br","br_FR"],["bs","bs_Latn_BA"],["ca","ca_ES"],["co","co_FR"],["cs","cs_CZ"],["cy","cy_GB"],["da","da_DK"],["de","de_DE"],["dsb","dsb_DE"],["dv","dv_MV"],["el","el_GR"],["en","en_US"],["es","es_ES"],["et","et_EE"],["eu","eu_ES"],["fa","fa_IR"],["fi","fi_FI"],["fil","fil_PH"],["fo","fo_FO"],["fr","fr_FR"],["fy","fy_NL"],["ga","ga_IE"],["sd","gd_GB"],["gl","gl_ES"],["gsw","gsw_FR"],["gu","gu_IN"],["ha","ha_Latn_NG"],["he","he_IL"],["hi","hi_IN"],["hr","hr_HR"],["hsb","hsb_DE"],["hu","hu_HU"],["hy","hy_AM"],["id","id_ID"],["ig","ig_NG"],["ii","ii_CN"],["is","is_IS"],["it","it_IT"],["iu","iu_Latn_CA"],["ja","ja_JP"],["ka","ka_GE"],["kk","kk_KZ"],["kl","kl_GL"],["km","km_KH"],["kn","kn_IN"],["kok","kok_IN"],["ko","ko_KR"],["ky","ky_KG"],["lb","lb_LU"],["lo","lo_LA"],["lt","lt_LT"],["lv","lv_LV"],["mi","mi_NZ"],["mk","mk_MK"],["ml","ml_IN"],["mn","mn_MN"],["moh","moh_CA"],["mr","mr_IN"],["ms","ms_MY"],["mt","mt_MT"],["nb","nb_NO"],["ne","ne_NP"],["nl","nl_NL"],["nn","nn_NO"],["nso","nso_ZA"],["oc","oc_FR"],["or","or_IN"],["pa","pa_IN"],["pl","pl_PL"],["prs","prs_AF"],["ps","ps_AF"],["pt","pt_PT"],["qut","qut_GT"],["rm","rm_CH"],["ro","ro_RO"],["ru","ru_RU"],["rw","rw_RW"],["sah","sah_RU"],["sa","sa_IN"],["si","si_LK"],["sk","sk_SK"],["sl","sl_SI"],["smn","smn_FI"],["sms","sms_FI"],["sq","sq_AL"],["sr","sr_Cyrl_CS"],["sv","sv_SE"],["sw","sw_KE"],["syr","syr_SY"],["ta","ta_IN"],["te","te_IN"],["tg","tg_Cyrl_TJ"],["th","th_TH"],["tk","tk_TM"],["tn","tn_ZA"],["tr","tr_TR"],["tt","tt_RU"],["tzm","tzm_Latn_DZ"],["ug","ug_CN"],["uk","uk_UA"],["ur","ur_PK"],["uz","uz_Latn_UZ"],["vi","vi_VN"],["wo","wo_SN"],["xh","xh_ZA"],["yo","yo_NG"],["zh","zh_CN"],["zu","zu_ZA"]]);try{var getPreference=findCallback("callbackGetLocalePreference");pref=getPreference();}catch(e){pref="false";}if(pref=="false"){this.sBrowserLocale=window.navigator.userLanguage||window.navigator.language;if(localeMap.has(this.sBrowserLocale)){this.sLocale=localeMap.get(this.sBrowserLocale);this.sBrowserLocale=this.sLocale.replace("-","_");data.sPVL=this.sBrowserLocale;data.sProductLocale=this.sBrowserLocale;}else{this.sBrowserLocale=this.sBrowserLocale.replace("-","_");data.sPVL=this.sBrowserLocale;data.sProductLocale=this.sBrowserLocale;}}else{data.sPVL="en_US";data.sProductLocale="en_US";}if(jsonData.documentlocale!=""&&jsonData.documentlocale!="1024"&&pref=="false"){data.sPVL=jsonData.documentlocale;}if(jsonData.productlocaledisplaystring!=""&&jsonData.productlocaledisplaystring!="1024"&&pref=="false"){data.sProductLocale=jsonData.productlocaledisplaystring;BILaunchpadApp.setProductLocaleNumber(jsonData.productlocale);}data.sTimeZone=jsonData.timezone;data.sTimezonedisplaystring=jsonData.timezonedisplaystring;data.sProductlocaledisplaystring=jsonData.productlocaledisplaystring;sap.ui.getCore().setModel(jsonData,"localePagePrefModel");};var localeError=function(xhr,ajaxOptions,thrownError){console.log("Unable to get locale information hence using browser locale");};var request={surl:data.sRestWebServiceURL+"/internal/v1/settings/userpreferences/localeandtimezone",reqType:"GET",bAsync:false,successHandler:setLocale,errorHandler:localeError,headers:{Accept:"application/json","Content-Type":"application/json;odata=verbose","x-sap-logontoken":data.logontoken}};var allSettingsModel=sap.ui.getCore().getModel("allSettingsModel");if(!allSettingsModel){reqDispatcher.sendRequest(request);}else{setLocale(allSettingsModel.oData.entries[3]);}};com.sap.fioribi.modules.logonpageBI.LogonpageBIController.prototype.initPagePreferences=function(){};com.sap.fioribi.modules.logonpageBI.LogonpageBIController.prototype.loadLaunchpadApp=function(data){jQuery.sap.require("com.sap.fioribi.app.BILaunchpadApp");var themeInstance=this;this.initLocaleAndTimeZones(data);this.initViewRights(data);var bSmtpFlag=true;try{var getSchSMTPDestination=findCallback("callbackGetSMTPProp");bSmtpFlag=getSchSMTPDestination();}catch(exp){bSmtpFlag=true;}var appSettings={logonToken:data.logontoken,webServiceURL:data.sRestWebServiceURL,pvl:data.sPVL,productLocale:data.sProductLocale,timeZone:data.sTimeZone,oRightsObj:data.oRightsObj,smtp:bSmtpFlag,timezonedisplaystring:data.sTimezonedisplaystring,productlocaledisplaystring:data.sProductlocaledisplaystring};var oCore=sap.ui.getCore();oCore.attachInit(function(){BILaunchpadApp.init(appSettings);themeInstance.initThemeing(data);});};redirectTologoff=function(){var invokeCallback=findCallback("callbackGetBTToken");var btToken;if(invokeCallback!=null){btToken=invokeCallback();}document.location.href="logoff.jsp?bttoken="+btToken;};com.sap.fioribi.modules.logonpageBI.LogonpageBIController.prototype.logonToBI=function(logonToken){var invokeCallbackWACURL=findCallback("callbackGetWACURL");var WACURL;if(invokeCallbackWACURL!=null){WACURL=invokeCallbackWACURL();if(WACURL===""||WACURL==null){sap.m.MessageBox.error("Unable to find WAC URL... And Logon Failed for WAC",{onClose:redirectTologoff});return;}}var callbackGetRestLogonToken=findCallback("callbackGetRestLogonToken");var RlogonToken;if(callbackGetRestLogonToken!=null){RlogonToken=callbackGetRestLogonToken();}var data={};data.logontoken=RlogonToken;data.sRestWebServiceURL=WACURL;var INITSETTINGS="/internal/v1/settings/allsettings?appCuid=Ac7UIwmYafpFuhiiw6FRXLQ";var RESTURL=WACURL;var LOGONURL=RESTURL+INITSETTINGS;var fnLogonSuccess=function(response){var jsonModel=new sap.ui.model.json.JSONModel(response);sap.ui.getCore().setModel(jsonModel,"allSettingsModel");this.loadLaunchpadApp(data);this.getView().destroyContent();};var fnLogonFailure=function(err){jQuery.sap.require("sap.m.MessageBox");if(err.length>0){sap.m.MessageBox.error(err);}else{sap.m.MessageBox.error("Logon failed for RESTful Web Services. Contact system administrator.",{onClose:redirectTologoff});}};var oHandler={success:$.proxy(fnLogonSuccess,this),error:$.proxy(fnLogonFailure,this)};try{$.ajax({cache:false,url:LOGONURL,type:"GET",headers:{Accept:"application/json","Content-Type":"application/json;odata=verbose","x-sap-logontoken":data.logontoken},beforeSend:function(){sap.ui.core.BusyIndicator.show(0);},complete:function(){sap.ui.core.BusyIndicator.hide(0);},success:function(data,textStatus,xhr){var fnSuccess=oHandler.success;fnSuccess(data);},error:function(xhr,textStatus,thrownError){var fnLogonFailure=oHandler.error;fnLogonFailure(thrownError);}});}catch(exception){fnLogonFailure(exception);}};
/*
ï¿½2010 - 2016 SAP SE or an SAP affiliate company.  All rights reserved.
 
SAP and other SAP products and services mentioned herein as well as their respective logos are trademarks or registered trademarks of SAP SE in Germany and other countries.  Please see http://www.sap.com/corporate-en/legal/copyright/index.epx#trademark for additional trademark information and notices.
*/

if("undefined"==typeof businessobjects){var businessobjects={};}businessobjects.webutil=businessobjects.webutil||{};businessobjects.webutil.fioribi=businessobjects.webutil.fioribi||{};businessobjects.webutil.fioribi.pinger=businessobjects.webutil.fioribi.pinger||{};businessobjects.webutil.fioribi.restful=businessobjects.webutil.fioribi.restful||{};var L_pinger_button_Continue;var L_pinger_button_Logoff;var L_pinger_mainWindow_WarningMessage;var L_pinger_mainWindow_ExpiredMessage;var L_pinger_otherWindow_WarningMessage;var L_pinger_otherWindow_ExpiredMessage;var L_pinger_title_WarningMessage;var L_pinger_title_ExpiredMessage;var L_dialogsevice_button_OK;var logoffUrl="logoff.jsp";var channel;businessobjects.webutil.fioribi.pinger.restful={logoffRestFul:function(){var reqDispatcher=new RequestDispatcher();var setRights=function(response){};var token=callbackGetRestLogonToken();var rightError=function(xhr,ajaxOptions,thrownError){};var request={surl:callbackGetWACURL()+"/v1/logoff",reqType:"POST",bAsync:false,successHandler:setRights,errorHandler:rightError,headers:{Accept:"application/json","Content-Type":"application/json;odata=verbose","x-sap-logontoken":token}};reqDispatcher.sendRequest(request);}};businessobjects.webutil.fioribi.pinger.Pinger={showWarningDialogMethods:new Array(),hideWarningDialogMethods:new Array(),showExpiryDialogMethods:new Array(),lastWarningDialog:null,lastExpiryDialog:null,regularTimeoutObject:null,mainAppKind:"InfoView",callback:{success:function(o){L_pinger_button_Continue=BILaunchpadApp.localized("continue");L_pinger_button_Logoff=BILaunchpadApp.localized("logoff");L_pinger_mainWindow_WarningMessage=BILaunchpadApp.localized("session_goingto_expire");L_pinger_mainWindow_ExpiredMessage=BILaunchpadApp.localized("session_expired");L_pinger_otherWindow_WarningMessage=BILaunchpadApp.localized("session_goingto_expire1");L_pinger_otherWindow_ExpiredMessage=BILaunchpadApp.localized("session_expired_pinger");L_pinger_title_WarningMessage=BILaunchpadApp.localized("session_timeout_warning");L_pinger_title_ExpiredMessage=BILaunchpadApp.localized("session_timeout");L_dialogsevice_button_OK=BILaunchpadApp.localized("filter_ok");var myJSON=JSON.parse(o);if(myJSON.showWarning=="false"&&myJSON.showExpiry=="false"){for(var i=0;i<businessobjects.webutil.fioribi.pinger.Pinger.hideWarningDialogMethods.length;i=i+1){try{businessobjects.webutil.fioribi.pinger.Pinger.hideWarningDialogMethods[i]();}catch(e){}}}else{if(myJSON.showWarning=="true"){var expiryTimeInMins=Math.ceil(myJSON.expiryTime/60000);for(var i=0;i<businessobjects.webutil.fioribi.pinger.Pinger.showWarningDialogMethods.length;i=i+1){try{businessobjects.webutil.fioribi.pinger.Pinger.showWarningDialogMethods[i](expiryTimeInMins);}catch(e){}}}else{if(myJSON.showExpiry=="true"){for(var i=0;i<businessobjects.webutil.fioribi.pinger.Pinger.showExpiryDialogMethods.length;i=i+1){try{businessobjects.webutil.fioribi.pinger.Pinger.showExpiryDialogMethods[i]();}catch(e){}}}}}if(myJSON.nextPingTime!=-1){businessobjects.webutil.fioribi.pinger.Pinger.regularTimeoutObject=setTimeout("businessobjects.webutil.fioribi.pinger.Pinger.ping()",myJSON.nextPingTime);}},failure:function(o){console.log("Unable to get the data BOETimeoutPing");},timeout:720000},initialize:function(){isMainWindow=true;appKind="InfoView";channel=new BroadcastChannel("Pinger-channel");if(!isMainWindow){var mainWin=businessobjects.webutil.fioribi.pinger.Pinger.findMainWin(window,window.parent);mainWin.businessobjects.webutil.fioribi.pinger.Pinger.showWarningDialogMethods.push(businessobjects.webutil.fioribi.pinger.Pinger.showAssociatedWindowWarningDialog);mainWin.businessobjects.webutil.fioribi.pinger.Pinger.hideWarningDialogMethods.push(businessobjects.webutil.fioribi.pinger.Pinger.hideWarningDialog);mainWin.businessobjects.webutil.fioribi.pinger.Pinger.showExpiryDialogMethods.push(businessobjects.webutil.fioribi.pinger.Pinger.showAssociatedWindowExpiryDialog);}else{businessobjects.webutil.fioribi.pinger.Pinger.mainAppKind=appKind;businessobjects.webutil.fioribi.pinger.Pinger.showWarningDialogMethods.push(businessobjects.webutil.fioribi.pinger.Pinger.showMainWindowWarningDialog);businessobjects.webutil.fioribi.pinger.Pinger.hideWarningDialogMethods.push(businessobjects.webutil.fioribi.pinger.Pinger.hideWarningDialog);businessobjects.webutil.fioribi.pinger.Pinger.showExpiryDialogMethods.push(businessobjects.webutil.fioribi.pinger.Pinger.showMainWindowExpiryDialog);businessobjects.webutil.fioribi.pinger.Pinger.regularTimeoutObject=setTimeout("businessobjects.webutil.fioribi.pinger.Pinger.ping()",2*60*1000);}},sendRequestToTimeoutManagerFilter:function(sData){var reqDispatcher=new RequestDispatcher();var request={surl:"BOETimeoutPing",reqType:"POST",successHandler:businessobjects.webutil.fioribi.pinger.Pinger.callback.success,errorHandler:businessobjects.webutil.fioribi.pinger.Pinger.callback.failure,data:sData,headers:{Accept:"application/json",}};reqDispatcher.sendRequest(request);},ping:function(){var reqDispatcher=new RequestDispatcher();var sData={resetCountdown:false,logoff:false,appKind:businessobjects.webutil.fioribi.pinger.Pinger.mainAppKind};businessobjects.webutil.fioribi.pinger.Pinger.sendRequestToTimeoutManagerFilter(sData);},findMainWin:function(curLoc,curParent){if(curLoc.isMainWindow){return curLoc;}if(curLoc===curParent){var temp=curLoc.opener;if(temp==null){return curLoc;}else{return businessobjects.webutil.fioribi.pinger.Pinger.findMainWin(temp,temp.parent);}}else{return businessobjects.webutil.fioribi.pinger.Pinger.findMainWin(curParent,curParent.parent);}},showMainWindowWarningDialog:function(expiryTimeInMins){if(businessobjects.webutil.fioribi.pinger.Pinger.lastWarningDialog!=null){businessobjects.webutil.fioribi.pinger.Pinger.lastWarningDialog.close();businessobjects.webutil.fioribi.pinger.Pinger.lastWarningDialog=null;}function warningHandler(oEvent){clearTimeout(businessobjects.webutil.fioribi.pinger.Pinger.regularTimeoutObject);var param;if(oEvent.getSource().getText()===L_pinger_button_Continue){param=1;}else{if(oEvent.getSource().getText()===L_pinger_button_Logoff){param=2;}}if(param==1){for(var i=0;i<businessobjects.webutil.fioribi.pinger.Pinger.hideWarningDialogMethods.length;i=i+1){try{businessobjects.webutil.fioribi.pinger.Pinger.hideWarningDialogMethods[i]();}catch(e){}}var sData={resetCountdown:true,logoff:false,appKind:businessobjects.webutil.fioribi.pinger.Pinger.mainAppKind};channel.postMessage(sData);businessobjects.webutil.fioribi.pinger.Pinger.sendRequestToTimeoutManagerFilter(sData);}else{if(param==2){for(var i=1;i<businessobjects.webutil.fioribi.pinger.Pinger.showExpiryDialogMethods.length;i=i+1){try{businessobjects.webutil.fioribi.pinger.Pinger.showExpiryDialogMethods[i]();}catch(e){}}var sData={resetCountdown:false,logoff:true,appKind:businessobjects.webutil.fioribi.pinger.Pinger.mainAppKind};channel.postMessage(sData);businessobjects.webutil.fioribi.pinger.Pinger.sendRequestToTimeoutManagerFilter(sData);window.location=logoffUrl;}}}var warningStr=L_pinger_mainWindow_WarningMessage.replace("{0}",expiryTimeInMins);var config={dialogType:businessobjects.webutil.fioribi.dialogservice.DialogConstants.TIMEOUT_WARNING_DIALOG,message:warningStr,title:L_pinger_title_WarningMessage,button_Continue_title:L_pinger_button_Continue,button_Logoff_title:L_pinger_button_Logoff,fnCallbackMessageBox:warningHandler,};businessobjects.webutil.fioribi.pinger.Pinger.lastWarningDialog=businessobjects.webutil.fioribi.dialogservice.DialogService.showDialog(config);businessobjects.webutil.fioribi.pinger.Pinger.lastWarningDialog.open();},showMainWindowExpiryDialog:function(){if(businessobjects.webutil.fioribi.pinger.Pinger.lastWarningDialog!=null){businessobjects.webutil.fioribi.pinger.Pinger.lastWarningDialog.close();businessobjects.webutil.fioribi.pinger.Pinger.lastWarningDialog=null;}if(businessobjects.webutil.fioribi.pinger.Pinger.lastExpiryDialog!=null){businessobjects.webutil.fioribi.pinger.Pinger.lastExpiryDialog.close();businessobjects.webutil.fioribi.pinger.Pinger.lastExpiryDialog=null;}businessobjects.webutil.fioribi.pinger.restful.logoffRestFul();var OK_BUTTON_VALUE=1;function expiryHandleronEsc(oEvent){setTimeout(function(){businessobjects.webutil.fioribi.pinger.Pinger.lastExpiryDialog.close();window.location=logoffUrl;},0);}function expiryHandler(oEvent){var param;if(oEvent.getSource().getText()===L_dialogsevice_button_OK){param=1;}if(param==OK_BUTTON_VALUE){businessobjects.webutil.fioribi.pinger.Pinger.lastExpiryDialog.close();window.location=logoffUrl;}}var config={dialogType:businessobjects.webutil.fioribi.dialogservice.DialogConstants.TIMEOUT_INFO_DIALOG,message:L_pinger_mainWindow_ExpiredMessage,title:L_pinger_title_ExpiredMessage,button_OK_title:L_dialogsevice_button_OK,fnCallbackMessageBox:expiryHandler,};businessobjects.webutil.fioribi.pinger.Pinger.lastExpiryDialog=businessobjects.webutil.fioribi.dialogservice.DialogService.showDialog(config);if(!BILaunchpadApp.isSessionTimeOut()){var sData={resetCountdown:false,logoff:true,appKind:"InfoView"};channel.postMessage(sData);businessobjects.webutil.fioribi.pinger.Pinger.lastExpiryDialog.open();BILaunchpadApp.setSessionTimeOut(true);businessobjects.webutil.fioribi.pinger.Pinger.lastExpiryDialog.setEscapeHandler(expiryHandleronEsc);}},showAssociatedWindowWarningDialog:function(expiryTimeInMins){if(window.businessobjects){if(businessobjects.webutil.fioribi.pinger.Pinger.lastWarningDialog!=null){businessobjects.webutil.fioribi.pinger.Pinger.lastWarningDialog.close();businessobjects.webutil.fioribi.pinger.Pinger.lastWarningDialog=null;}function warningHandler(oEvent){var param;if(oEvent.getSource().getText()===L_pinger_button_Continue){param=1;}if(param==1){var mainWin=businessobjects.webutil.fioribi.pinger.Pinger.findMainWin(window,window.parent);clearTimeout(mainWin.businessobjects.webutil.fioribi.pinger.Pinger.regularTimeoutObject);for(var i=0;i<mainWin.businessobjects.webutil.fioribi.pinger.Pinger.hideWarningDialogMethods.length;i=i+1){try{mainWin.businessobjects.webutil.fioribi.pinger.Pinger.hideWarningDialogMethods[i]();}catch(e){}}var sData={resetCountdown:true,logoff:false,appKind:businessobjects.webutil.fioribi.pinger.Pinger.mainAppKind};channel.postMessage(sData);businessobjects.webutil.fioribi.pinger.Pinger.sendRequestToTimeoutManagerFilter(sData);}}var warningStr=L_pinger_otherWindow_WarningMessage.replace("{0}",expiryTimeInMins);var config={dialogType:businessobjects.webutil.fioribi.dialogservice.DialogConstants.CUSTOM_MESSAGE_DIALOG,message:warningStr,title:L_pinger_title_WarningMessage,button_Continue_title:L_pinger_button_Continue,fnCallbackMessageBox:warningHandler,};businessobjects.webutil.fioribi.pinger.Pinger.lastWarningDialog=businessobjects.webutil.fioribi.dialogservice.DialogService.showDialog(config);businessobjects.webutil.fioribi.pinger.Pinger.lastWarningDialog.open();}},hideWarningDialog:function(){if(window.businessobjects){if(businessobjects.webutil.fioribi.pinger.Pinger.lastWarningDialog!=null){businessobjects.webutil.fioribi.pinger.Pinger.lastWarningDialog.close();businessobjects.webutil.fioribi.pinger.Pinger.lastWarningDialog=null;}}},showAssociatedWindowExpiryDialog:function(){if(window.businessobjects){if(businessobjects.webutil.fioribi.pinger.Pinger.lastExpiryDialog!=null){return;}if(businessobjects.webutil.fioribi.pinger.Pinger.lastWarningDialog!=null){businessobjects.webutil.fioribi.pinger.Pinger.lastWarningDialog.close();businessobjects.webutil.fioribi.pinger.Pinger.lastWarningDialog=null;}if(businessobjects.webutil.fioribi.pinger.Pinger.lastExpiryDialog!=null){businessobjects.webutil.fioribi.pinger.Pinger.lastExpiryDialog.close();businessobjects.webutil.fioribi.pinger.Pinger.lastExpiryDialog=null;}var sData={resetCountdown:false,logoff:true,appKind:"InfoView"};channel.postMessage(sData);var config={dialogType:businessobjects.webutil.fioribi.dialogservice.DialogConstants.NO_CLOSE_MESSAGE_DIALOG,message:L_pinger_otherWindow_ExpiredMessage,title:L_pinger_title_ExpiredMessage,fnCallbackMessageBox:function(){},};businessobjects.webutil.fioribi.pinger.Pinger.lastExpiryDialog=businessobjects.webutil.fioribi.dialogservice.DialogService.showDialog(config);businessobjects.webutil.fioribi.pinger.Pinger.lastExpiryDialog.open();}},expireAssociatedWindows:function(){for(var i=1;i<businessobjects.webutil.fioribi.pinger.Pinger.showExpiryDialogMethods.length;i=i+1){try{businessobjects.webutil.fioribi.pinger.Pinger.showExpiryDialogMethods[i]();}catch(e){}}}};businessobjects.webutil.fioribi.pinger.Pinger.initialize();
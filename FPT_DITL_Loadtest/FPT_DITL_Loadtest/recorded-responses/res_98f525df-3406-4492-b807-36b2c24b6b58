/*
ï¿½2010 - 2016 SAP SE or an SAP affiliate company.  All rights reserved.
 
SAP and other SAP products and services mentioned herein as well as their respective logos are trademarks or registered trademarks of SAP SE in Germany and other countries.  Please see http://www.sap.com/corporate-en/legal/copyright/index.epx#trademark for additional trademark information and notices.
*/

jQuery.sap.declare({modName:"com.sap.fioribi.components.dialogsave.DialogSaveController",type:"controller"});jQuery.sap.require({modName:"com.sap.fioribi.modules.common.BILPController",type:"controller"});com.sap.fioribi.components.dialogsave.DialogSaveController=function(){this.ofolderModel=new sap.ui.model.json.JSONModel();this.olistModel=new sap.ui.model.json.JSONModel();this.oCategoryListModel=new sap.ui.model.json.JSONModel();this.oPathModel=new sap.ui.model.json.JSONModel();this.oCategoryModel=new sap.ui.model.json.JSONModel();var data=[];var obj={entries:data};this.oPathModel.setData(obj);this.oCategoryModel.setData(obj);this.favoriteFolderID="";this.currentFolderID="";this.currentParentID=23;this.sId=null;this.sTitle=null;this.fnSaveAsCallback=null;this.sWebServicePath=null;this.sLogonToken="";jQuery.sap.require("com.sap.fioribi.components.dialogsave.DialogSaveModel");this.oModel=new CategoriesListModel();this.selectedTokensModel=new sap.ui.model.json.JSONModel();var dataSelected=[];var obj={entries:dataSelected};this.selectedTokensModel.setData(obj);this.selectedTokensModel=new sap.ui.model.json.JSONModel();this.selectedTokensModel.setData(obj);this.removedTokensModel=new sap.ui.model.json.JSONModel();var dataRemoved=[];var obj={entries:dataRemoved};this.removedTokensModel.setData(obj);this.removedTokensModel=new sap.ui.model.json.JSONModel();this.removedTokensModel.setData(obj);this.oRightsObj=BILaunchpadApp.getRightsObject();};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype=jQuery.sap.newObject(com.sap.fioribi.modules.common.BILPController.prototype);com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.getId=function(){return this.sId;};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.setId=function(sId){this.sId=sId;};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.getFolderInfo=function(fId){var fID=fId;var $this=this;jQuery.sap.require("com.sap.fioribi.utils.RequestDispatcher");var reqDispatcher=new RequestDispatcher();var getFolderIDError=function(xhr,ajaxOptions,thrownError){var clsBtn=new sap.m.Button({text:BILaunchpadApp.localized("Recycle_Bin_Close"),press:$.proxy(function(){errDialog.close();},this)});var errDialog=new sap.m.Dialog().addButton(clsBtn);errDialog.open();BILaunchpadApp.oErrorHandler.showErrorMessage(xhr,errDialog);sap.ui.core.BusyIndicator.hide();};var getFolderIDSuccess=function(response){if(fId==response.id){$this.currentFolderID=response.cuid;$this.initialFolderID=response.cuid;}if(response.id==$this.favoriteFolderID){var data=$this.oPathModel.getProperty("/entries");var folderPath={name:BILaunchpadApp.localized("My_Folders"),id:$this.favoriteFolderID,cuid:$this.favoriteFolderID};data.push(folderPath);$this.oPathModel.setProperty("/entries",data);var dataRev=$this.oPathModel.getProperty("/entries");dataRev.reverse();$this.oPathModel.setProperty("/entries",dataRev);var modified=$this.ofolderModel.getData();modified.entries[0].expanded=true;modified.entries[0].selectedflag=true;var pathData=$this.oPathModel.getProperty("/entries");$this.expandTreeForNav(pathData,"/entries/0",folderPath.cuid);$this.updateList(response.cuid);}else{if(response.parentid!="23"&&response.parentid!=$this.favoriteFolderID){var folderPath={name:response.name,id:response.id,cuid:response.cuid};var data=$this.oPathModel.getProperty("/entries");data.push(folderPath);$this.oPathModel.setProperty("/entries",data);$this.getFolderInfo(response.parentid);$this.updateList(response.cuid);}else{if(response.parentid=="23"){var folderPath={name:response.name,id:response.id,cuid:response.cuid};var data=$this.oPathModel.getProperty("/entries");data.push(folderPath);var folderPath={name:BILaunchpadApp.localized("Public_Folders"),id:"23",cuid:"23"};data.push(folderPath);$this.oPathModel.setProperty("/entries",data);var dataRev=$this.oPathModel.getProperty("/entries");dataRev.reverse();$this.oPathModel.setProperty("/entries",dataRev);$this.updateList(response.cuid);var modified=$this.ofolderModel.getData();modified.entries[1].expanded=true;modified.entries[1].selectedflag=true;var pathData=$this.oPathModel.getProperty("/entries");$this.expandTreeForNav(pathData,"/entries/1",folderPath.cuid);$this.updateList(response.cuid);}else{var folderPath={name:response.name,id:response.id,cuid:response.cuid};var data=$this.oPathModel.getProperty("/entries");data.push(folderPath);var folderPath={name:BILaunchpadApp.localized("My_Folders"),id:$this.favoriteFolderID,cuid:$this.favoriteFolderID};data.push(folderPath);$this.oPathModel.setProperty("/entries",data);var dataRev=$this.oPathModel.getProperty("/entries");dataRev.reverse();$this.oPathModel.setProperty("/entries",dataRev);var modified=$this.ofolderModel.getData();modified.entries[0].expanded=true;modified.entries[0].selectedflag=true;var pathData=$this.oPathModel.getProperty("/entries");$this.expandTreeForNav(pathData,"/entries/0",folderPath.cuid);$this.updateList(response.cuid);}}}sap.ui.core.BusyIndicator.hide();};var request={surl:BILaunchpadApp.getWebServiceBaseURL()+"/internal/v1/folders/"+fID,reqType:"GET",bAsync:false,successHandler:getFolderIDSuccess,errorHandler:getFolderIDError,headers:{"x-SAP-logonToken":BILaunchpadApp.getlogonToken(),Accept:"application/json","Content-Type":"application/json;odata=verbose",}};sap.ui.core.BusyIndicator.show(0);reqDispatcher.sendRequest(request);};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.initialize=function(){var $this=this;jQuery.sap.require("com.sap.fioribi.utils.RequestDispatcher");var reqDispatcher=new RequestDispatcher();$this.getFavoriteFolderID();var obj_category={entries:[{name:BILaunchpadApp.localized("Personal_Categories"),expanded:false,selectedflag:true},{name:BILaunchpadApp.localized("Corporate_Categories"),expanded:false,selectedflag:false}]};var obj_pf={entries:[{name:BILaunchpadApp.localized("My_Folders"),cuid:"",count:"1",expanded:false,selectedflag:false},{name:BILaunchpadApp.localized("Public_Folders"),cuid:"23",count:"1",expanded:false,selectedflag:false}]};var obj_f={entries:[{name:BILaunchpadApp.localized("My_Folders"),cuid:"",count:"1",expanded:false,selectedflag:false}]};this.oCategoryModel.setData(obj_category);var obj={entries:[]};if(this.oRightsObj.favoritefolderview||this.oRightsObj.folderview){if(this.oRightsObj.favoritefolderview&&this.oRightsObj.folderview){$this.ofolderModel.setData(obj_pf);}else{$this.ofolderModel.setData(obj_f);}var getFoldersListError=function(xhr,ajaxOptions,thrownError){var clsBtn=new sap.m.Button({text:BILaunchpadApp.localized("Recycle_Bin_Close"),press:$.proxy(function(){errDialog.close();},this)});var errDialog=new sap.m.Dialog().addButton(clsBtn);errDialog.open();BILaunchpadApp.oErrorHandler.showErrorMessage(xhr,errDialog);sap.ui.core.BusyIndicator.hide();};var getFoldersListSuccess=function(response){jQuery.sap.require("com.sap.fioribi.utils.typeFormatter");for(i=0;i<response.entries.length;i++){response.entries[i].displaytype=updatedtypeFormat(response.entries[i].type);}sap.ui.core.BusyIndicator.hide();};var request={surl:this.sWebServicePath+"/internal/v1/favoritefolders",reqType:"GET",successHandler:getFoldersListSuccess,errorHandler:getFoldersListError,headers:{"x-SAP-logonToken":this.sLogonToken,Accept:"application/json","Content-Type":"application/json;odata=verbose",}};sap.ui.core.BusyIndicator.show(0);reqDispatcher.sendRequest(request);}else{$this.ofolderModel.setData(obj);}};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.getFavoriteFolderID=function(logonToken){var $this=this;jQuery.sap.require("com.sap.fioribi.utils.RequestDispatcher");var reqDispatcher=new RequestDispatcher();var getFavoriteFolderIDError=function(xhr,ajaxOptions,thrownError){var clsBtn=new sap.m.Button({text:BILaunchpadApp.localized("Recycle_Bin_Close"),press:$.proxy(function(){errDialog.close();},this)});var errDialog=new sap.m.Dialog().addButton(clsBtn);errDialog.open();BILaunchpadApp.oErrorHandler.showErrorMessage(xhr,errDialog);sap.ui.core.BusyIndicator.hide();};var getFavoriteFolderIDSuccess=function(response){$this.favoriteFolderID=response.favoritefolderid;$this.ofolderModel.setProperty("/entries/0/cuid",response.favoritefolderid);sap.ui.core.BusyIndicator.hide();};var request={surl:BILaunchpadApp.getWebServiceBaseURL()+"/internal/v1/user",reqType:"GET",bAsync:false,successHandler:getFavoriteFolderIDSuccess,errorHandler:getFavoriteFolderIDError,headers:{"x-SAP-logonToken":BILaunchpadApp.getlogonToken(),Accept:"application/json","Content-Type":"application/json;odata=verbose",}};sap.ui.core.BusyIndicator.show(0);reqDispatcher.sendRequest(request);};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.getRootFavoriteFolders=function(){var $this=this;var reqDispatcher=new RequestDispatcher();var getUserFavoriteFolderIdError=function(xhr,ajaxOptions,thrownError){var clsBtn=new sap.m.Button({text:BILaunchpadApp.localized("Recycle_Bin_Close"),press:$.proxy(function(){errDialog.close();},this)});var errDialog=new sap.m.Dialog().addButton(clsBtn);errDialog.open();BILaunchpadApp.oErrorHandler.showErrorMessage(xhr,errDialog);sap.ui.core.BusyIndicator.hide();return"";};var getUserFavoriteFolderIdSuccess=function(response){var list=response.entries;var newList=[];for(var i=0;i<response.entries.length;i++){if(list[i].type=="Folder"){newList.push(list[i]);}}path="/entries/0/entries";$this.ofolderModel.setProperty(path,newList);sap.ui.core.BusyIndicator.hide();};var request={surl:BILaunchpadApp.getWebServiceBaseURL()+"/internal/v1/favoritefolders",reqType:"GET",successHandler:getUserFavoriteFolderIdSuccess,errorHandler:getUserFavoriteFolderIdError,headers:{"x-SAP-logonToken":BILaunchpadApp.getlogonToken(),Accept:"application/json","Content-Type":"application/json;odata=verbose",}};sap.ui.core.BusyIndicator.show(0);reqDispatcher.sendRequest(request);};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.expandTree=function(path,cuid){var $this=this;var reqDispatcher=new RequestDispatcher();if(path==="/entries/0"){this.getRootFavoriteFolders();return;}var expandTreeError=function(xhr,ajaxOptions,thrownError){var clsBtn=new sap.m.Button({text:BILaunchpadApp.localized("Recycle_Bin_Close"),press:$.proxy(function(){errDialog.close();},this)});var errDialog=new sap.m.Dialog().addButton(clsBtn);errDialog.open();BILaunchpadApp.oErrorHandler.showErrorMessage(xhr,errDialog);sap.ui.core.BusyIndicator.hide();};var expandTreeSuccess=function(response){path+="/entries";$this.ofolderModel.setProperty(path,response.entries);sap.ui.core.BusyIndicator.hide();};var request={surl:BILaunchpadApp.getWebServiceBaseURL()+"/internal/v1/folders/"+cuid+"/children?type='folder'&paging=0",reqType:"GET",successHandler:expandTreeSuccess,errorHandler:expandTreeError,headers:{"x-SAP-logonToken":this.sLogonToken,Accept:"application/json","Content-Type":"application/json;odata=verbose",}};sap.ui.core.BusyIndicator.show(0);reqDispatcher.sendRequest(request);};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.expandTreeForNav=function(data,path,cuid){var $this=this;var reqDispatcher=new RequestDispatcher();var expandValue=0;var expandCuid="";var expandTreeError=function(xhr,ajaxOptions,thrownError){var clsBtn=new sap.m.Button({text:BILaunchpadApp.localized("Recycle_Bin_Close"),press:$.proxy(function(){errDialog.close();},this)});var errDialog=new sap.m.Dialog().addButton(clsBtn);errDialog.open();BILaunchpadApp.oErrorHandler.showErrorMessage(xhr,errDialog);sap.ui.core.BusyIndicator.hide();};var expandTreeSuccess=function(response){data=data.slice(1,data.length);if(data.length!=0){for(var j=0;j<response.entries.length;j++){if(data[0].cuid==response.entries[j].cuid){response.entries[j].expanded=true;response.entries[j].selectedflag=true;expandValue=j;expandCuid=response.entries[j].cuid;}else{response.entries[j].expanded=false;}}}path+="/entries";$this.ofolderModel.setProperty(path,response.entries);if(data.length!=0){$this.expandTreeForNav(data,path+"/"+expandValue,expandCuid);}sap.ui.core.BusyIndicator.hide();};var request={surl:BILaunchpadApp.getWebServiceBaseURL()+"/internal/v1/folders/"+cuid+"/children?type='folder'&paging=0",reqType:"GET",bAsync:false,successHandler:expandTreeSuccess,errorHandler:expandTreeError,headers:{"x-SAP-logonToken":this.sLogonToken,Accept:"application/json","Content-Type":"application/json;odata=verbose",}};sap.ui.core.BusyIndicator.show(0);reqDispatcher.sendRequest(request);};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.updateList=function(cuid){var $this=this;var reqDispatcher=new RequestDispatcher();if(cuid==""||cuid==undefined){cuid=this.favoriteFolderID;}this.cuid=cuid;var updateListError=function(xhr,ajaxOptions,thrownError){var clsBtn=new sap.m.Button({text:BILaunchpadApp.localized("Recycle_Bin_Close"),press:$.proxy(function(){errDialog.close();},this)});var errDialog=new sap.m.Dialog().addButton(clsBtn);errDialog.open();BILaunchpadApp.oErrorHandler.showErrorMessage(xhr,errDialog);sap.ui.core.BusyIndicator.hide();};var updateListSuccess=function(response){$this.olistModel.setSizeLimit(response.entries.length);$this.olistModel.setData(response);$this.currentParentID=$this.cuid;sap.ui.core.BusyIndicator.hide();};var request={surl:this.sWebServicePath+"/internal/v1/folders/"+cuid+"/children?paging=0",reqType:"GET",bAsync:false,successHandler:updateListSuccess,errorHandler:updateListError,headers:{"x-SAP-logonToken":this.sLogonToken,Accept:"application/json","Content-Type":"application/json;odata=verbose",}};sap.ui.core.BusyIndicator.show(0);reqDispatcher.sendRequest(request);};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.updateListByBreadcrumb=function(cuid,name,path){var $this=this;var reqDispatcher=new RequestDispatcher();this.cuid=cuid;this.name=name;this.path=path;this.updateList(cuid);var list=$this.path.split("/");var item=list[list.length-1];data=this.oPathModel.getProperty("/entries");var removeItems=(data.length-1)-item;for(var i=0;i<removeItems;i++){data.pop();}this.oPathModel.setProperty("/entries",data);};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.updateBreadcrumbAdd=function(cuid,name,id){var $this=this;if(cuid==""||id==""){cuid=$this.favoriteFolderID;id=$this.favoriteFolderID;}var folderPath={name:name,id:id,cuid:cuid};var data=$this.oPathModel.getProperty("/entries");data.push(folderPath);$this.oPathModel.setProperty("/entries",data);};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.setWebServicePath=function(sWebPath){this.sWebServicePath=sWebPath;};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.setLogonToken=function(sLogonToken){this.sLogonToken=sLogonToken;};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.setSaveAsCallback=function(fnCallback){this.fnSaveAsCallback=fnCallback;};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.saveAs=function(name,type,parentcuid,customParams,selectedTokens,removedTokens){var saveAsObj={id:this.sId,name:name,type:type,parentFolderCUID:parentcuid};if(customParams){$.extend(saveAsObj,customParams);}if(selectedTokens.length>0){$.extend(saveAsObj,{selectedTokens:selectedTokens});}if(removedTokens.length>0){$.extend(saveAsObj,{removedTokens:removedTokens});}if(this.fnSaveAsCallback&&typeof this.fnSaveAsCallback=="function"){this.fnSaveAsCallback(saveAsObj);}else{var eventBus=sap.ui.getCore().getEventBus();eventBus.publish(BILaunchpadApp.oConstants.PLATFORM_EXTERNAL_CHANNEL,BILaunchpadApp.oConstants.SAVE_DOCUMENT_AS_EVENT,saveAsObj);}};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.createFolder=function(cuid,name3,desc,key_words){var $this=this;var reqDispatcher=new RequestDispatcher();this.folderDetails={keywords:key_words,name:name3,description:desc,parentid:String(cuid)};var createFolderError=function(xhr,ajaxOptions,thrownError){var errorMsg=xhr.message.toString();var duplicateFolderCode="(FWB 00026)";if(errorMsg.indexOf(duplicateFolderCode)!==-1){sap.m.MessageToast.show(BILaunchpadApp.localized("duplicateFolder"));}else{sap.m.MessageToast.show(BILaunchpadApp.localized("Error_Fail_folder_creation"));}sap.ui.core.BusyIndicator.hide();};var createFolderSuccess=function(response){sap.m.MessageToast.show("'"+this.folderDetails.name+"'"+BILaunchpadApp.localized("Folder_created"));$this.updateList(cuid);sap.ui.core.BusyIndicator.hide();};var request={surl:this.sWebServicePath+"/v1/folders/folder",reqType:"POST",successHandler:$.proxy(createFolderSuccess,this),errorHandler:createFolderError,data:JSON.stringify(this.folderDetails),headers:{"x-SAP-logonToken":this.sLogonToken,Accept:"application/json","Content-Type":"application/json;odata=verbose",}};if(cuid==$this.favoriteFolderID){request.surl=this.sWebServicePath+"/internal/v1/favoritefolders/folder";}sap.ui.core.BusyIndicator.show(0);reqDispatcher.sendRequest(request);};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.setSelectedTokens=function(selectedCategory){var data=this.selectedTokensModel.getProperty("/entries");data.push({id:selectedCategory.id,cuid:selectedCategory.cuid,type:selectedCategory.type,name:selectedCategory.name});this.selectedTokensModel.setProperty("/entries",data);};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.setRemovedTokens=function(removedCategory){var data=this.removedTokensModel.getProperty("/entries");data.push({id:removedCategory.id,cuid:removedCategory.cuid,type:removedCategory.type,name:removedCategory.name});this.removedTokensModel.setProperty("/entries",data);};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.resetTokensModels=function(){this.selectedTokensModel.setData({entries:[]});this.removedTokensModel.setData({entries:[]});};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.resetPathModels=function(){this.oPathModel.setData({entries:[]});};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.resetCategoryModels=function(){this.oView.Categorieslist.setModel(this.oModel.getPersonalCategories());};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.listCategories=function(docId){var $this=this;var reqDispatcher=new RequestDispatcher();var createError=function(xhr,ajaxOptions,thrownError){var clsBtn=new sap.m.Button({text:BILaunchpadApp.localized("Recycle_Bin_Close"),press:$.proxy(function(){errDialog.close();},this)});var errDialog=new sap.m.Dialog().addButton(clsBtn);errDialog.open();BILaunchpadApp.oErrorHandler.showErrorMessage(xhr,errDialog);sap.ui.core.BusyIndicator.hide();};var createSuccess=function(response){$this.oModel.setSelectedCategories(response.entries);$this.getRootTree();sap.ui.core.BusyIndicator.hide();};var request={surl:BILaunchpadApp.getWebServiceBaseURL()+"/v1/documents/"+docId+"/categories",reqType:"GET",successHandler:createSuccess,errorHandler:createError,headers:{"x-SAP-logonToken":BILaunchpadApp.getlogonToken(),Accept:"application/json","Content-Type":"application/json;odata=verbose",}};sap.ui.core.BusyIndicator.show(0);reqDispatcher.sendRequest(request);};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.ModelModification=function(response){var data=$this.oModel.getSelectedCategories().getData();var currentData=$this.selectedTokensModel.getData().entries;data=data.concat(currentData);var sizeSelected=data.length;var sizeAll=response.entries.length;for(i=0;i<sizeAll;i++){for(j=0;j<sizeSelected;j++){if(response.entries[i].cuid==data[j].cuid){response.entries[i].selected=true;break;}else{response.entries[i].selected=false;}}}};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.getRootTree=function(){$this=this;var reqDispatcher=new RequestDispatcher();var currentView=this;var selectedCategories=[];var getPersonalCategoriesListSuccess=function(response){$this.ModelModification(response);$this.oModel.setPersonalCategories(response);sap.ui.core.BusyIndicator.hide();reqDispatcher.sendRequest(requestCorporate);};var getCorporateCategoriesListSuccess=function(response){$this.ModelModification(response);$this.oModel.setCorporateCategories(response);sap.ui.core.BusyIndicator.hide();};var error=function(xhr,ajaxOptions,thrownError){var clsBtn=new sap.m.Button({text:BILaunchpadApp.localized("Recycle_Bin_Close"),press:$.proxy(function(){errDialog.close();},this)});var errDialog=new sap.m.Dialog().addButton(clsBtn);errDialog.open();BILaunchpadApp.oErrorHandler.showErrorMessage(xhr,errDialog);sap.ui.core.BusyIndicator.hide();};var requestPersonal={surl:BILaunchpadApp.getWebServiceBaseURL()+"/internal/v1/categories/root/personalcategories",reqType:"GET",successHandler:getPersonalCategoriesListSuccess,errorHandler:error,headers:{Accept:"application/json","Content-Type":"application/json;odata=verbose","x-sap-logontoken":BILaunchpadApp.getlogonToken()}};var requestCorporate={surl:BILaunchpadApp.getWebServiceBaseURL()+"/internal/v1/categories/root/corporatecategories",reqType:"GET",successHandler:getCorporateCategoriesListSuccess,errorHandler:error,headers:{Accept:"application/json","Content-Type":"application/json;odata=verbose","x-sap-logontoken":BILaunchpadApp.getlogonToken()}};sap.ui.core.BusyIndicator.show(0);reqDispatcher.sendRequest(requestPersonal);};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.expandPersonalCategoriesTree=function(path,cuid){var $this=this;var reqDispatcher=new RequestDispatcher();var expandTreeError=function(xhr,ajaxOptions,thrownError){var clsBtn=new sap.m.Button({text:BILaunchpadApp.localized("Recycle_Bin_Close"),press:$.proxy(function(){errDialog.close();},this)});var errDialog=new sap.m.Dialog().addButton(clsBtn);errDialog.open();BILaunchpadApp.oErrorHandler.showErrorMessage(xhr,errDialog);bError=true;sap.ui.core.BusyIndicator.hide();};var expandTreeSuccess=function(response){path+="/entries";$this.ModelModification(response);$this.oModel.getPersonalCategories().setProperty(path,response.entries);sap.ui.core.BusyIndicator.hide();};var request={surl:BILaunchpadApp.getWebServiceBaseURL()+"/internal/v1/categories/"+cuid+"/children",reqType:"GET",successHandler:expandTreeSuccess,errorHandler:expandTreeError,headers:{"x-SAP-logonToken":BILaunchpadApp.getlogonToken(),Accept:"application/json","Content-Type":"application/json;odata=verbose",}};sap.ui.core.BusyIndicator.show(0);reqDispatcher.sendRequest(request);};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.expandCorporateCategoriesTree=function(path,cuid){var $this=this;var reqDispatcher=new RequestDispatcher();var expandTreeError=function(xhr,ajaxOptions,thrownError){var clsBtn=new sap.m.Button({text:BILaunchpadApp.localized("Recycle_Bin_Close"),press:$.proxy(function(){errDialog.close();},this)});var errDialog=new sap.m.Dialog().addButton(clsBtn);errDialog.open();BILaunchpadApp.oErrorHandler.showErrorMessage(xhr,errDialog);sap.ui.core.BusyIndicator.hide();};var expandTreeSuccess=function(response){path+="/entries";$this.ModelModification(response);$this.oModel.getCorporateCategories().setProperty(path,response.entries);sap.ui.core.BusyIndicator.hide();};var request={surl:BILaunchpadApp.getWebServiceBaseURL()+"/internal/v1/categories/"+cuid+"/children",reqType:"GET",successHandler:expandTreeSuccess,errorHandler:expandTreeError,headers:{"x-SAP-logonToken":BILaunchpadApp.getlogonToken(),Accept:"application/json","Content-Type":"application/json;odata=verbose",}};sap.ui.core.BusyIndicator.show(0);reqDispatcher.sendRequest(request);};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.expandCategoriesTree=function(path,cuid){var $this=this;var url="";var reqDispatcher=new RequestDispatcher();var expandTreeError=function(xhr,ajaxOptions,thrownError){var clsBtn=new sap.m.Button({text:BILaunchpadApp.localized("Recycle_Bin_Close"),press:$.proxy(function(){errDialog.close();},this)});var errDialog=new sap.m.Dialog().addButton(clsBtn);errDialog.open();BILaunchpadApp.oErrorHandler.showErrorMessage(xhr,errDialog);sap.ui.core.BusyIndicator.hide();};var expandTreeSuccess=function(response){path+="/entries";$this.oCategoryModel.setProperty(path,response.entries);sap.ui.core.BusyIndicator.hide();};var request={surl:BILaunchpadApp.getWebServiceBaseURL()+"/internal/v1/categories/"+cuid+"/children",reqType:"GET",successHandler:expandTreeSuccess,errorHandler:expandTreeError,headers:{"x-SAP-logonToken":BILaunchpadApp.getlogonToken(),Accept:"application/json","Content-Type":"application/json;odata=verbose",}};sap.ui.core.BusyIndicator.show(0);reqDispatcher.sendRequest(request);};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.expandRootTree=function(path){var personalData=$this.oModel.getPersonalCategories().getData();var corporateData=$this.oModel.getCorporateCategories().getData();if(path=="/entries/0"){path+="/entries";this.oCategoryModel.setProperty(path,personalData.entries);}else{if(path=="/entries/1"){path+="/entries";this.oCategoryModel.setProperty(path,corporateData.entries);}}};com.sap.fioribi.components.dialogsave.DialogSaveController.prototype.updateCategoryList=function(cuid){var $this=this;var url="";var reqDispatcher=new RequestDispatcher();var expandTreeError=function(xhr,ajaxOptions,thrownError){var clsBtn=new sap.m.Button({text:BILaunchpadApp.localized("Recycle_Bin_Close"),press:$.proxy(function(){errDialog.close();},this)});var errDialog=new sap.m.Dialog().addButton(clsBtn);errDialog.open();BILaunchpadApp.oErrorHandler.showErrorMessage(xhr,errDialog);sap.ui.core.BusyIndicator.hide();};var expandTreeSuccess=function(response){$this.ModelModification(response);$this.oModel.setCategoriesList(response);sap.ui.core.BusyIndicator.hide();};var request={surl:BILaunchpadApp.getWebServiceBaseURL()+"/internal/v1/categories/"+cuid+"/children",reqType:"GET",bAsync:false,successHandler:expandTreeSuccess,errorHandler:expandTreeError,headers:{"x-SAP-logonToken":BILaunchpadApp.getlogonToken(),Accept:"application/json","Content-Type":"application/json;odata=verbose",}};sap.ui.core.BusyIndicator.show(0);reqDispatcher.sendRequest(request);};
/*
ï¿½2010 - 2016 SAP SE or an SAP affiliate company.  All rights reserved.
 
SAP and other SAP products and services mentioned herein as well as their respective logos are trademarks or registered trademarks of SAP SE in Germany and other countries.  Please see http://www.sap.com/corporate-en/legal/copyright/index.epx#trademark for additional trademark information and notices.
*/

jQuery.sap.declare("com.sap.fioribi.widgets.GenericTile");jQuery.sap.require("com.sap.fioribi.utils.iconImage");var that=this;sap.ui.core.Control.extend("com.sap.fioribi.widgets.GenericTile",{metadata:{properties:{icon:"string",cuid:"string",objectName:"string",count:"string",kind:"string",contentImageSrc:"string",lastRef:"string",fav:"boolean",callBackObj:"object",reportenginetype:"string",schedulestatus:"string",iconstatus:"string",isinstance:"string"},aggregations:{content:{singularName:"content"}}},renderer:function(oRm,oControl){oRm.write("<div");oRm.writeControlData(oControl);oRm.writeClasses();oRm.write(">");var cuid=oControl.getCuid();var reportenginetype=oControl.getReportenginetype();var title=oControl.getObjectName();var children=oControl.getCount();var type=oControl.getKind();var status=oControl.getSchedulestatus();var iconstatus=oControl.getIconstatus();var responseType=type;if(responseType=="CrystalReport"){if(reportenginetype=="1"||reportenginetype=="0"){responseType=responseType+reportenginetype;}}var contentImageSrc=oControl.getContentImageSrc();if(contentImageSrc==""&&type=="PersonalCategory"){contentImageSrc="com/sap/fioribi/images/personal-category.png";}else{if(contentImageSrc==""&&type=="Category"){contentImageSrc="com/sap/fioribi/images/corporate-category.png";}}var lastRef=oControl.getLastRef();var oCallbackObj=oControl.getCallBackObj();this.oListBox=oCallbackObj.oListBox;this.oController=oCallbackObj.oController;this.processCAF=this.oController.processActions;var context=oControl.getBindingContext();var fav=oControl.getFav();var $this=this;var oCustomTile=new sap.m.CustomTile({}).addDelegate({onAfterRendering:function(event){$(".sapMGTFocusDiv ").css("left","0");$(".sapMGTFocusDiv ").css("right","0");$(".sapMGTFocusDiv ").css("top","0");$(".sapMGTFocusDiv ").css("bottom","0");$(".sapMGTFocusDiv ").css("border","none");$(".sapMTileCntFtrTxt").css("display","none");$(".sapMCustomTileContent").css("cursor","pointer");document.getElementById(oCustomTile.getId()).setAttribute("role","button");}});oCustomTile.addStyleClass("BILP-tileBackgroundColor BILP-BorderNone BILP-borderbox BILP-Padding");var oFooterSettingsIcon;var favIcon;var favIconhbox;var oFooter;var oTileContent;var oTile;var oFooter3;var StatusIcon;var setFilter={flag:1};var childPress="0";var isTileClick=true;var isCategoryClicked=false;var tileTooltip=new sap.ui.commons.RichTooltip({atPosition:"left center",openDelay:250,closeDelay:10,});jQuery.sap.require("com.sap.fioribi.utils.ObjectTypeIcon2");var icon=new com.sap.fioribi.utils.ObjectTypeIcon2(type);if(type=="PersonalCategory"||type=="Category"){var oCUIDCatgCustData=new sap.ui.core.CustomData({key:"cuid",writeToDom:false,value:cuid});var oTitleCatgCustData=new sap.ui.core.CustomData({key:"title",writeToDom:false,value:title});var oTypeCatgCustData=new sap.ui.core.CustomData({key:"type",writeToDom:false,value:type});var oContextData=new sap.ui.core.CustomData({key:"context",writeToDom:false,value:context});oCustomTile.addCustomData(oContextData);oCustomTile.addCustomData(oCUIDCatgCustData);oCustomTile.addCustomData(oTitleCatgCustData);oCustomTile.addCustomData(oTypeCatgCustData);oCustomTile.addStyleClass("BILP-customTileForCategory");oCustomTile.addDelegate({onAfterRendering:function(event){$(".BILP-customTileForCategory>.sapMCustomTileContent").css("background-size","cover");}}).addStyleClass("BILP-customTileForCategory");if(type=="PersonalCategory"){sType="Personal Category";}if(type=="Category"){sType="Category";}oFooterSettingsIcon=new sap.ui.core.Icon({src:"sap-icon://overflow",size:"20px",color:"#cae4fb",tooltip:BILaunchpadApp.localized("More_Actions_Tooltip"),customData:[new sap.ui.core.CustomData({key:"cuid",writeToDom:false,value:cuid}),new sap.ui.core.CustomData({key:"context",writeToDom:false,value:context})],press:function(e){var src=e.getSource();var objContext=this.data().context;isTileClick=false;childPress="1";$this.processCAF(this,this.data().context);}}).addStyleClass("BILP-size32px");favIcon=new sap.ui.core.Icon({src:"sap-icon://favorite",size:"1rem",width:"0.75rem",tooltip:BILaunchpadApp.localized("tooltip_for_remove_from_favorites"),customData:[new sap.ui.core.CustomData({key:"cuid",writeToDom:false,value:cuid}),new sap.ui.core.CustomData({key:"context",writeToDom:false,value:context})],press:function(e){isTileClick=false;childPress="1";if(fav){$this.oController.markAsUnFav(this.data().context);}}});favIconhbox=new sap.m.HBox({displayInline:true,items:[favIcon]}).addStyleClass("BILP-favIconHboxFooter");if(fav){favIcon.removeStyleClass("BILP-favIconDisplayNone");favIcon.addStyleClass("BILP-favIconDisplayBlockForCategory BILP-favIcon");}else{favIcon.removeStyleClass("BILP-favIconDisplayBlockForCategory");favIcon.addStyleClass("BILP-favIconDisplayNone BILP-favIcon");}var oTitle=new sap.m.Label({text:title,}).addStyleClass("BILP-TitleCategoryTile  BILP-TabTitleTrunc");var categTitle=new sap.m.Label({text:title}).addStyleClass("BILP-TitleCategoryTile  BILP-TabTitleTrunc");var oType=new sap.m.Label({text:sType,}).addStyleClass("BILP-TypeCategoryTile");var oFooter1=new sap.m.VBox({items:[categTitle,oType]}).addStyleClass("BILP-Footer1");var oFooter2=new sap.m.VBox({items:[new sap.m.Label({text:children}).addStyleClass("BILP-CountCategoryTile"),new sap.m.Label({text:"Files"}).addStyleClass("BILP-FilesCategoryTile")]}).addStyleClass("BILP-Footer2");oFooter3=new sap.m.VBox({items:[icon,oFooterSettingsIcon]}).addStyleClass("BILP-Footer3");var icon1=new sap.m.Image({src:contentImageSrc,mode:sap.m.ImageMode.Background,backgroundSize:"initial"}).addStyleClass("BILP-sizepx");var oHbox1=new sap.m.HBox({displayInline:true,items:[oFooter1,favIconhbox,oFooter2,oFooter3]});oHbox1.addStyleClass("BILP-TileoptionsIE BILP-TileOptionsFireFox BILP-Widthbox");var oGrid=new sap.ui.layout.Grid({content:[oHbox1]}).addStyleClass("BILP-BlackFooterCategoryTile");var oHbox2=new sap.m.HBox({items:[oGrid]}).addStyleClass("BILP-HBox2");var imagebox=new sap.m.VBox({displayInline:true,items:[icon1,oHbox2]});imagebox.addStyleClass("BILP-imageBox");oCustomTile.setContent(imagebox);oCustomTile.attachPress(function(e){if(isTileClick&&!isCategoryClicked){if(childPress=="0"&&$this.oController.getView().getControllerName().indexOf("categoriesController")==-1){isCategoryClicked=true;cuid=e.getSource().data("cuid");title=e.getSource().data("title");type=e.getSource().data("type");var customObjContext={children:"0",contentImageSrc:"",count:"",created:"",cuid:"",description:"",displaytype:"BI Workspace",fav:true,filter:"home_myfavorites",headerIconClass:"BILP-size32px BILP-Webi",icon:"",id:"Documents",imagepath:"",instances:"0",keywords:"",lastRef:"",lastRun:"",name:"Categories",opendocurl:"",owner:"Administrator",parentcuid:"",parentid:"",tileType:"doc",type:"AFDashboardPage",updated:"",dcoViewId:""};var oCafObj={techname:"view"};BILaunchpadApp.setSelectedCategory(cuid);BILaunchpadApp.setCategoryName(title);BILaunchpadApp.setCategory("true");BILaunchpadApp.oActionPanel.oController.setCurrentObject(customObjContext);BILaunchpadApp.oActionPanel.oController.peformAction(oCafObj);BILaunchpadApp.setSelectedCategory(null);BILaunchpadApp.setCategory(null);BILaunchpadApp.setCategoryName(null);}else{if($this.oController.getView().getControllerName().indexOf("categoriesController")>=0){var src=e.getSource();var sCUID=src.data().cuid;var name=src.data().title;var type=src.data().type;var imageurl=e.getSource().mAggregations.content.mAggregations.items[0].getProperty("src");if(type==="Category"||type==="PersonalCategory"||type=="Personal Category"){$this.oController.updateTable(sCUID,name,false,null,imageurl);}}}childPress="0";window.setTimeout(function(){isCategoryClicked=false;},1000);}else{isTileClick=true;}});tileTooltip.setText(title);if(title!=undefined&&title.length>20){oCustomTile.setTooltip(tileTooltip);}}else{oCustomTile.addStyleClass("BILP-customTile");var oCUIDDocCustData=new sap.ui.core.CustomData({key:"cuid",writeToDom:false,value:cuid});var oContextData=new sap.ui.core.CustomData({key:"context",writeToDom:false,value:context});oCustomTile.addCustomData(oCUIDDocCustData);oCustomTile.addCustomData(oContextData);var docTitle=new sap.m.Label({text:sap.ui.base.ManagedObject.escapeSettingsValue(title)}).addStyleClass("BILP-docTitle");oCustomTile.addStyleClass("BILP-customTileForDocument");oFooterSettingsIcon=new sap.ui.core.Icon({src:"sap-icon://overflow",size:"1rem",width:"1rem",tooltip:BILaunchpadApp.localized("More_Actions_Tooltip"),customData:[new sap.ui.core.CustomData({key:"cuid",writeToDom:false,value:cuid}),new sap.ui.core.CustomData({key:"context",writeToDom:false,value:context})],press:function(e){isTileClick=false;childPress="1";$this.processCAF(this,this.data().context);}}).addStyleClass("sapUiSizeCompact BILP-marginleft");if(oControl.getIconstatus()!=null&&oControl.getIconstatus()!=undefined){var iconSrc=statusIcon(iconstatus);var iconColor=statusColor(iconstatus);var StatusIcon=new sap.ui.core.Icon({size:"1rem",src:iconSrc,color:iconColor,decorative:false});StatusIcon.setTooltip(status);}favIcon=new sap.m.Button({icon:"sap-icon://favorite",size:"1rem",width:"0.75rem",active:true,tooltip:BILaunchpadApp.localized("tooltip_for_remove_from_favorites"),title:BILaunchpadApp.localized("tooltip_for_remove_from_favorites"),role:"Button",customData:[new sap.ui.core.CustomData({key:"cuid",writeToDom:false,value:cuid}),new sap.ui.core.CustomData({key:"context",writeToDom:false,value:context})],press:function(e){isTileClick=false;childPress="1";if(fav){$this.oController.markAsUnFav(this.data().context);}}});favIcon.addStyleClass("BILP-favIconDisplayNone BILP-favIcon");if(fav){favIcon.removeStyleClass("BILP-favIconDisplayNone");favIcon.addStyleClass("BILP-favIconDisplayBlockTile BILP-favIconDisplayBlockTileBorder BILP-favIconDisplayIcon BILP-favIcon");}else{favIcon.addStyleClass("BILP-favIconDisplayNone BILP-favIcon");}var lastRefLabel=new sap.m.Label({text:lastRef}).addStyleClass("BILP-docSubHeader");oHeader3=new sap.m.VBox({items:[docTitle,lastRefLabel]}).addStyleClass("BILP-docVboxHeader");tileTooltip.setText(title);if(title!=undefined&&title.length>20){oHeader3.setTooltip(tileTooltip);}var docTypeLabel=new sap.m.Label({text:updatedtypeFormat(responseType)}).addStyleClass("BILP-Tile_DocType");oFooter3HBox=new sap.m.HBox({items:[favIcon,StatusIcon,oFooterSettingsIcon]});oFooter3=new sap.m.VBox({items:[icon,docTypeLabel,oFooter3HBox]}).addStyleClass("BILP-docVboxFooter");var oGrid=new sap.ui.layout.Grid({content:[oHeader3,oFooter3]});oCustomTile.setContent(oGrid);oCustomTile.attachPress(function(e){if(isTileClick){if(childPress=="0"){var src=e.getSource();var objContext=this.data().context;var objData=objContext.getProperty(objContext.getPath());if(objData.filter=="home_myfavorites"&&objData.type=="Folder"){var customObjContext={children:"0",contentImageSrc:"",count:"",created:"",cuid:"",description:"",displaytype:"BI Workspace",fav:true,filter:"home_myfavorites",headerIconClass:"BILP-size32px BILP-Webi",icon:"",id:"Documents",imagepath:"",instances:"0",keywords:"",lastRef:"",lastRun:"",name:"Folders",opendocurl:"",owner:"Administrator",parentcuid:"",parentid:"",tileType:"doc",type:"AFDashboardPage",updated:"",dcoViewId:""};var oCafObj={techname:"view"};BILaunchpadApp.setSelectedFolder(cuid);BILaunchpadApp.setFavFolderSelected("true");BILaunchpadApp.oActionPanel.oController.setCurrentObject(customObjContext);BILaunchpadApp.oActionPanel.oController.peformAction(oCafObj);}else{if(BILaunchpadApp.navPoints[BILaunchpadApp.navPoints.length-1].level==0){BILaunchpadApp.navPoints.push({level:BILaunchpadApp.navPoints[BILaunchpadApp.navPoints.length-1].level+1,curr:"",prev:"tabPage",backAction:"tabPage"});}else{BILaunchpadApp.navPoints.push({level:BILaunchpadApp.navPoints[BILaunchpadApp.navPoints.length-1].level+1,curr:"",prev:BILaunchpadApp.navPoints[BILaunchpadApp.navPoints.length-1].curr,backAction:BILaunchpadApp.navPoints[BILaunchpadApp.navPoints.length-1].curr});}if($this.oController.fnViewDocument!=undefined){sap.ui.core.BusyIndicator.show(0);setTimeout(function(){$this.oController.fnViewDocument(objContext);sap.ui.core.BusyIndicator.hide();},10);}}}childPress="0";}else{isTileClick=true;}});tileTooltip.setText(title);}function showBusyIndicator(iDuration,iDelay){sap.ui.core.BusyIndicator.show(iDelay);if(iDuration&&iDuration>0){window.setTimeout(hideBusyIndicator,iDuration);}}function hideBusyIndicator(){sap.ui.core.BusyIndicator.hide();}oRm.renderControl(oCustomTile);oRm.write("</div>");}});
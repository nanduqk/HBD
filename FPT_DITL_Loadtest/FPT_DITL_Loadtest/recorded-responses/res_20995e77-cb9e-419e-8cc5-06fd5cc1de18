/*
ï¿½2010 - 2016 SAP SE or an SAP affiliate company.  All rights reserved.
 
SAP and other SAP products and services mentioned herein as well as their respective logos are trademarks or registered trademarks of SAP SE in Germany and other countries.  Please see http://www.sap.com/corporate-en/legal/copyright/index.epx#trademark for additional trademark information and notices.
*/

(function(){jQuery.sap.declare("com.sap.fioribi.widgets.CanvasShapesManager");var Point=function(x,y){this.x=x||0;this.y=y||0;};Point.prototype.getDistance=function(point2){var x=this.x-point2.x;var y=this.y-point2.y;return Math.floor(Math.sqrt(x*x+y*y));};Point.prototype.getSegment=function(oCenter){if(this.x<=oCenter.x&&this.y<=oCenter.y){return 1;}if(this.x<=oCenter.x&&this.y>=oCenter.y){return 2;}if(this.x>=oCenter.x&&this.y>=oCenter.y){return 3;}if(this.x>=oCenter.x&&this.y<=oCenter.y){return 4;}};Point.prototype.offset=function(iOffsetX,iOffsetY){this.x=this.x+iOffsetX;this.y=this.y+iOffsetY;};var Range=function(iXmin,iXmax,iYmin,iYmax){this.x={min:iXmin,max:iXmax};this.y={min:iYmin,max:iYmax};};var canvasWidth=(window.innerWidth>0)?window.innerWidth:screen.width;var canvasHeight=(window.innerHeight>0)?window.innerHeight:screen.height;var centerRanges={cpr1:new Range(0,canvasWidth/4,0,canvasHeight/4),cpr2:new Range(canvasWidth/2,canvasWidth,0,canvasHeight/4),cpr3:new Range(canvasWidth/4,3*canvasWidth/4,canvasHeight*3/4,canvasHeight)};var requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(callback){return setTimeout(callback,1);};var manager=function(){this.init();};manager.prototype={radiusRange:{min:800,max:900},init:function(){this.Id="shell-shapes";var cprs={cpr1:centerRanges.cpr1,cpr2:centerRanges.cpr2,cpr3:centerRanges.cpr3},radius,center,squarePoints,bezierCurves,isMobile=sap.ui.Device.system.phone;this.shapes=[];var cpr;for(cpr in cprs){radius=Math.random(this.radiusRange.max-this.radiusRange.min)+this.radiusRange.min;center=this.getRandomPoint(cprs[cpr]);squarePoints=this._getSquarePoints(radius,center);bezierCurves=this._calculatebezierCurves(radius,squarePoints);this.shapes.push({bezierCurves:bezierCurves,centerPoint:center});}for(var shape in this.shapes){var values=this._generateRandomAmorphousShapeValues();this.shapes[shape]=this.makeAmorphousShape(this.shapes[shape],values.edge0.edgeNum,values.edge0.xOffSet,values.edge0.yOffSet,values.edge0.xStretch);this.shapes[shape]=this.makeAmorphousShape(this.shapes[shape],values.edge1.edgeNum,values.edge1.xOffSet,values.edge1.yOffSet,values.edge1.xStretch);}sap.ui.Device.resize.attachHandler(this.resizeHandler,this);if(!isMobile){sap.ui.getCore().getEventBus().subscribe("launchpad","afterSwitchState",this.startAnimation,this);}},_generateRandomAmorphousShapeValues:function(){var values={edge0:{edgeNum:0,xOffSet:0,yOffSet:0,xStretch:0},edge1:{edgeNum:0,xOffSet:0,yOffSet:0,xStretch:0}};var num=this._getRandomInt(0,3);for(var edge in values){values[edge].edgeNum=num;values[edge].xOffSet=this._getRandomInt(200,400);values[edge].yOffSet=this._getRandomInt(-200,-400);num+=this._getRandomInt(0,1)<0.5?-1:1;if(num===-1){num=3;}if(num===4){num=0;}}num=this._getRandomInt(0,1);if(num<0.5){num=num<0.25?0:1;values["edge"+num].xStretch=this._getRandomInt(0,200);}return values;},getPoint:function(x,y){return new Point(x,y);},getRandomPoint:function(range){var x=Math.floor(Math.random()*(range.x.max-range.x.min)+range.x.min),y=Math.floor(Math.random()*(range.y.max-range.y.min)+range.y.min);return new Point(x,y);},resizeHandler:function(){var canvas=jQuery("#"+this.Id)[0];if(canvas){canvas.width=window.innerWidth;canvas.height=window.innerHeight;this.drawShapes();}},startAnimation:function(evt,ctx,oData){var duration=2500;var translateOffset,current1=this.shapes[0].centerPoint.x,current2=this.shapes[1].centerPoint.x,current3=this.shapes[2].centerPoint.x,direction,rem=parseFloat(jQuery("body").css("font-size")),sTo=oData.getParameter("to"),sFrom=oData.getParameter("from");if(!this.leftOffset||!this.rigthOffset){this.setTranslateOffset();}if(sTo==="RightCenter"){direction=1;translateOffset=this.rigthOffset*rem;}if(sTo==="LeftCenter"){direction=-1;translateOffset=this.leftOffset*rem;}if(sTo==="Center"){if(sFrom==="RightCenter"){direction=-1;translateOffset=this.rigthOffset*rem;}if(sFrom==="LeftCenter"){direction=1;translateOffset=this.leftOffset*rem;}}this.animateTranslation(current1,current2,current3,translateOffset,duration,direction);},setTranslateOffset:function(){var oTheming=sap.ui.core.theming.Parameters,sLeftViewPortWidth,sRightViewPortWidth;if(window.matchMedia("(min-width: 1920px)").matches){sLeftViewPortWidth="50rem";sRightViewPortWidth="68rem";}else{if(window.matchMedia("(min-width: 1600px)").matches){sLeftViewPortWidth="47rem";sRightViewPortWidth="65rem";}else{if(window.matchMedia("(min-width: 1440px)").matches){sLeftViewPortWidth="47rem";sRightViewPortWidth="60rem";}else{if(window.matchMedia("(min-width: 1280px)").matches){sLeftViewPortWidth="47rem";sRightViewPortWidth="55rem";}else{if(window.matchMedia("(min-width: 1024px)").matches){sLeftViewPortWidth="36rem";sRightViewPortWidth="49rem";}else{if(window.matchMedia("(min-width: 601px)").matches){sLeftViewPortWidth="36rem";sRightViewPortWidth="68rem";}else{if(window.matchMedia("(max-width : 600px)").matches){sLeftViewPortWidth=(jQuery(window).width()/parseFloat(jQuery("body").css("font-size")))+"";sRightViewPortWidth=(jQuery(window).width()/parseFloat(jQuery("body").css("font-size")))+"";}}}}}}}this.leftOffset=parseInt(sLeftViewPortWidth.replace("rem",""),10);this.rigthOffset=parseInt(sRightViewPortWidth.replace("rem",""),10);},animateTranslation:function(current1,current2,current3,translateX,duration,direction){var start=new Date().getTime();var end=start+duration,distance3=translateX,distance1=translateX/4,distance2=translateX/2,offset1,offset2,offset3,that=this;var step=function(){var timestamp=new Date().getTime(),progress=1-Math.pow(1-Math.min((duration-(end-timestamp))/duration,1),5);offset1=current1+direction*distance1*progress;offset2=current2+direction*distance2*progress;offset3=current3+direction*distance3*progress;that.updateShapes(offset1,offset2,offset3);that.drawShapes();if(progress<1){requestAnimationFrame(step);}};return step();},updateShapes:function(offset1,offset2,offset3){var that=this,delta1=this.shapes[0].centerPoint.x-offset1,delta2=this.shapes[1].centerPoint.x-offset2,delta3=this.shapes[2].centerPoint.x-offset3;this.shapes[0].centerPoint=new Point(offset1,this.shapes[0].centerPoint.y);this.shapes[1].centerPoint=new Point(offset2,this.shapes[1].centerPoint.y);this.shapes[2].centerPoint=new Point(offset3,this.shapes[2].centerPoint.y);this.shapes[0].bezierCurves.forEach(function(oCurve,iIndex){that.shapes[0].bezierCurves[iIndex].controlPoint1=new Point(oCurve.controlPoint1.x+delta1,oCurve.controlPoint1.y);that.shapes[0].bezierCurves[iIndex].controlPoint2=new Point(oCurve.controlPoint2.x+delta1,oCurve.controlPoint2.y);that.shapes[0].bezierCurves[iIndex].startPoint=new Point(oCurve.startPoint.x+delta1,oCurve.startPoint.y);that.shapes[0].bezierCurves[iIndex].endPoint=new Point(oCurve.endPoint.x+delta1,oCurve.endPoint.y);});this.shapes[1].bezierCurves.forEach(function(oCurve,iIndex){that.shapes[1].bezierCurves[iIndex].controlPoint1=new Point(oCurve.controlPoint1.x+delta2,oCurve.controlPoint1.y);that.shapes[1].bezierCurves[iIndex].controlPoint2=new Point(oCurve.controlPoint2.x+delta2,oCurve.controlPoint2.y);that.shapes[1].bezierCurves[iIndex].startPoint=new Point(oCurve.startPoint.x+delta2,oCurve.startPoint.y);that.shapes[1].bezierCurves[iIndex].endPoint=new Point(oCurve.endPoint.x+delta2,oCurve.endPoint.y);});this.shapes[2].bezierCurves.forEach(function(oCurve,iIndex){that.shapes[2].bezierCurves[iIndex].controlPoint1=new Point(oCurve.controlPoint1.x+delta3,oCurve.controlPoint1.y);that.shapes[2].bezierCurves[iIndex].controlPoint2=new Point(oCurve.controlPoint2.x+delta3,oCurve.controlPoint2.y);that.shapes[2].bezierCurves[iIndex].startPoint=new Point(oCurve.startPoint.x+delta3,oCurve.startPoint.y);that.shapes[2].bezierCurves[iIndex].endPoint=new Point(oCurve.endPoint.x+delta3,oCurve.endPoint.y);});},makeAmorphousShape:function(shape,startPoint,xOffSet,yOffSet,xStretch){var controlPoint1,controlPoint2,controlPoints;switch(startPoint){case 0:controlPoint1=shape.bezierCurves[0].controlPoint1;controlPoint2=shape.bezierCurves[3].controlPoint2;controlPoints=this._rotatePoints(xOffSet,yOffSet,controlPoint1,controlPoint2);shape.bezierCurves[0].controlPoint1=controlPoints[0];shape.bezierCurves[3].controlPoint2=controlPoints[1];break;case 1:controlPoint1=shape.bezierCurves[0].controlPoint2;controlPoint2=shape.bezierCurves[1].controlPoint1;controlPoints=this._rotatePoints(xOffSet,yOffSet,controlPoint1,controlPoint2);shape.bezierCurves[0].controlPoint2=controlPoints[0];shape.bezierCurves[1].controlPoint1=controlPoints[1];break;case 2:controlPoint1=shape.bezierCurves[1].controlPoint2;controlPoint2=shape.bezierCurves[2].controlPoint1;controlPoints=this._rotatePoints(xOffSet,yOffSet,controlPoint1,controlPoint2);shape.bezierCurves[1].controlPoint2=controlPoints[0];shape.bezierCurves[2].controlPoint1=controlPoints[1];break;case 3:controlPoint1=shape.bezierCurves[2].controlPoint2;controlPoint2=shape.bezierCurves[3].controlPoint1;controlPoints=this._rotatePoints(xOffSet,yOffSet,controlPoint1,controlPoint2);shape.bezierCurves[2].controlPoint2=controlPoints[0];shape.bezierCurves[3].controlPoint1=controlPoints[1];break;}return shape;},_rotatePoints:function(xOffSet,yOffSet,controlPoint1,controlPoint2){var x,y,controlsPoints=[];x=controlPoint1.x+xOffSet;y=controlPoint1.y+yOffSet;controlsPoints.push(new Point(x,y));x=controlPoint2.x-xOffSet;y=controlPoint2.y-yOffSet;controlsPoints.push(new Point(x,y));return controlsPoints;},_getSquarePoints:function(radius,center){var squarePoints=[];squarePoints[0]=new Point(center.x+radius,center.y);squarePoints[1]=new Point(center.x,center.y-radius);squarePoints[2]=new Point(center.x-radius,center.y);squarePoints[3]=new Point(center.x,center.y+radius);return squarePoints;},_getRandomInt:function(min,max){if(min==0&&max==1){return Math.random();}return Math.floor(Math.random()*(max-min+1))+min;},_calculatebezierCurves:function(radius,squarePoints){var bezierCurves=[];var controlPoint1;var controlPoint2;var endPoint,startPoint;startPoint=squarePoints[0];endPoint=squarePoints[1];controlPoint1=new Point(startPoint.x,startPoint.y-radius/2);controlPoint2=new Point(startPoint.x-radius/2,startPoint.y-radius);bezierCurves.push({startPoint:startPoint,endPoint:endPoint,controlPoint1:controlPoint1,controlPoint2:controlPoint2});startPoint=squarePoints[1];endPoint=squarePoints[2];controlPoint1=new Point(startPoint.x-radius/2,startPoint.y);controlPoint2=new Point(startPoint.x-radius,startPoint.y+radius/2);bezierCurves.push({startPoint:startPoint,endPoint:endPoint,controlPoint1:controlPoint1,controlPoint2:controlPoint2});startPoint=squarePoints[2];endPoint=squarePoints[3];controlPoint1=new Point(startPoint.x,startPoint.y+radius/2);controlPoint2=new Point(startPoint.x+radius/2,startPoint.y+radius);bezierCurves.push({startPoint:startPoint,endPoint:endPoint,controlPoint1:controlPoint1,controlPoint2:controlPoint2});startPoint=squarePoints[3];endPoint=squarePoints[0];controlPoint1=new Point(startPoint.x+radius/2,startPoint.y);controlPoint2=new Point(startPoint.x+radius,startPoint.y-radius/2);bezierCurves.push({startPoint:startPoint,endPoint:endPoint,controlPoint1:controlPoint1,controlPoint2:controlPoint2});return bezierCurves;},drawShapes:function(){var canvas=jQuery("#"+this.Id)[0],sBGColor=sap.ui.core.theming.Parameters.get("sapUshellShellBackgroundShapesColor");if(!sBGColor){sBGColor="rgba(255,255,255,0.08)";}if(canvas&&canvas.getContext){var context=canvas.getContext("2d"),startPoint,endPoint,controlPoint1,controlPoint2;context.clearRect(0,0,canvasWidth*2,canvasHeight*2);if(sBGColor){for(var j=0;j<this.shapes.length;j++){context.beginPath();startPoint=this.shapes[j].bezierCurves[0].startPoint;context.moveTo(startPoint.x,startPoint.y);for(var i=0;i<this.shapes[j].bezierCurves.length;i++){endPoint=this.shapes[j].bezierCurves[i].endPoint;controlPoint1=this.shapes[j].bezierCurves[i].controlPoint1;controlPoint2=this.shapes[j].bezierCurves[i].controlPoint2;context.bezierCurveTo(Math.floor(controlPoint1.x),Math.floor(controlPoint1.y),Math.floor(controlPoint2.x),Math.floor(controlPoint2.y),Math.floor(endPoint.x),Math.floor(endPoint.y));}context.closePath();context.fillStyle=sBGColor;context.fill();}}}}};com.sap.fioribi.widgets.CanvasShapesManager=new manager();})();